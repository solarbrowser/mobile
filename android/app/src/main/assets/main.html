<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        :root {
            /* Dynamic theme variables - will be set by applyTheme() */
            --bg-primary: #ffffff;
            --bg-surface: #f5f5f5;
            --text-primary: #000000;
            --text-secondary: #757575;
            --color-primary: #2196f3;
            --color-accent: #1976d2;
            --color-error: #f44336;
            --color-success: #4caf50;
            --color-warning: #ff9800;
            --color-secondary: #e0e0e0;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
        }

        .logo {
            width: 80px; /* Increased from 64px */
            height: 80px; /* Increased from 64px */
            margin-bottom: 8px; /* Reduced for logo+label */
            border-radius: 16px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .solar-label {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 24px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .search-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .search-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-engine-logo {
            position: absolute;
            left: 12px;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
        }

        .search-engine-logo img {
            width: 20px;
            height: 20px;
            object-fit: contain;
            border-radius: 3px;
        }

        .search-box {
            width: 100%;
            padding: 16px 16px 16px 44px; /* Left padding for icon */
            border: 2px solid var(--color-secondary);
            border-radius: 28px;
            font-size: 16px;
            background: var(--bg-surface);
            color: var(--text-primary);
            outline: none;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            border-color: var(--color-primary);
            background: var(--bg-primary);
            box-shadow: 0 4px 20px rgba(33, 150, 243, 0.1);
            transform: translateY(-2px);
        }

        .search-box::placeholder {
            color: var(--text-secondary);
        }

        .shortcuts-container {
            width: 100%;
        }

        .news-section {
            width: 100%;
            margin-top: 20px;
        }

        .news-header {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
        }

        .news-item {
            display: block;
            text-decoration: none;
            background: var(--bg-surface);
            border: 1px solid var(--color-secondary);
            border-radius: 16px;
            padding: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            overflow: hidden;
        }

        .news-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            border-color: var(--color-primary);
        }

        .news-item-image {
            width: 100%;
            height: 120px;
            border-radius: 12px;
            margin-bottom: 12px;
            object-fit: cover;
        }

        .news-item-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }        .news-item-summary {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .news-item-summary.expanded {
            display: block;
            -webkit-line-clamp: unset;
            line-clamp: unset;
            overflow: visible;
        }        .news-item-expand {
            font-size: 13px;
            font-weight: 500;
            color: var(--color-primary);
            cursor: pointer;
            margin: 12px 0 8px 0;
            text-align: center;
            padding: 8px 16px;
            border: 2px solid var(--color-primary);
            border-radius: 20px;
            background: var(--bg-primary);
            transition: all 0.3s ease;
            display: inline-block;
            min-width: 120px;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
        }

        .news-item-expand:hover {
            background: var(--color-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(33, 150, 243, 0.2);
        }

        .news-item-source {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .news-loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
            font-size: 16px;
        }

        .news-error {
            text-align: center;
            padding: 40px;
            color: var(--color-error);
            font-size: 16px;
        }

        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 16px;
            width: 100%;
        }

        .shortcut-item {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: var(--bg-surface);
            border: 1px solid var(--color-secondary);
            border-radius: 16px;
            text-decoration: none;
            color: var(--text-primary);
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 120px;
        }

        .shortcut-menu {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: var(--color-error);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            cursor: pointer;
            transition: opacity 0.2s ease;
            font-size: 12px;
            z-index: 10;
        }

        .shortcut-item:hover .shortcut-menu {
            opacity: 1;
        }

        .shortcut-menu:hover {
            background: var(--color-error);
            color: white;
        }

        .shortcut-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            background: var(--color-primary);
            color: white;
        }

        .shortcut-item.add-new {
            border: 2px dashed var(--color-primary);
            background: transparent;
            color: var(--color-primary);
        }

        .shortcut-item.add-new:hover {
            background: var(--color-primary);
            color: white;
        }

        .shortcut-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--color-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 12px;
        }

        .shortcut-title {
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            line-height: 1.3;
            opacity: 0.9;
        }

        .add-icon {
            font-size: 32px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .logo {
                width: 64px;
                height: 64px;
            }

            .solar-label {
                font-size: 16px;
            }

            .search-container {
                gap: 8px;
            }

            .search-engine-logo {
                width: 16px;
                height: 16px;
                left: 10px;
            }

            .search-engine-logo img {
                width: 16px;
                height: 16px;
            }

            .search-box {
                padding: 14px 14px 14px 36px;
                font-size: 16px;
            }

            .news-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .shortcuts-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }

            .shortcut-item {
                padding: 16px 12px;
                min-height: 100px;
            }

            .shortcut-icon {
                width: 40px;
                height: 40px;
                font-size: 20px;
                margin-bottom: 8px;
            }

            .shortcut-title {
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .container {
                gap: 30px;
            }

            .shortcuts-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .shortcut-item {
                padding: 12px 8px;
                min-height: 90px;
            }

            .shortcut-icon {
                width: 36px;
                height: 36px;
                font-size: 18px;
                margin-bottom: 6px;
            }

            .shortcut-title {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="flutter_assets/assets/icon.png" alt="Solar Browser" class="logo" onerror="console.log('Logo failed to load'); this.style.display='none';" style="width: 120px; height: 120px;">

        <div class="search-container">
            <div class="search-input-container">
                <div class="search-engine-logo" id="searchEngineLogo">
                    <img src="https://www.google.com/favicon.ico" alt="Google" id="searchEngineIcon">
                </div>
                <input type="text" class="search-box" placeholder="Search or enter address" autocomplete="off">
            </div>
        </div>

        <div class="shortcuts-container">
            <div class="shortcuts-grid" id="shortcutsGrid">
                <!-- Dynamic shortcuts will be added here -->                <div class="shortcut-item add-new" onclick="addNewShortcut()">
                    <div class="shortcut-icon">
                        <span class="add-icon">+</span>
                    </div>
                    <div class="shortcut-title" id="addSiteText">Add Site</div>
                </div>
            </div>
        </div>

        <div class="news-section" id="newsSection">
            <div class="news-header">
                <span id="newsTitle">Vertex News</span>
            </div>
            <div id="newsContent">
                <div class="news-loading" id="newsLoading">Loading news...</div>
            </div>
        </div>
    </div>    <script>
        console.log('🚀 SCRIPT START - Testing if JavaScript executes');
        console.log('🚀 Solar Browser main.html loaded - CLEAN VERSION WITH REAL NEWS');
        
        // Shortcuts data
        let shortcuts = JSON.parse(localStorage.getItem('solarShortcuts') || '[]');
        
        // Search engines configuration
        const searchEngines = {
            'Google': {
                name: 'Google',
                icon: 'https://www.google.com/favicon.ico',
                url: 'https://www.google.com/search?q={query}'
            },
            'Bing': {
                name: 'Bing',
                icon: 'https://www.bing.com/favicon.ico',
                url: 'https://www.bing.com/search?q={query}'
            },
            'DuckDuckGo': {
                name: 'DuckDuckGo',
                icon: 'https://duckduckgo.com/favicon.ico',
                url: 'https://duckduckgo.com/?q={query}'
            },
            'Brave': {
                name: 'Brave',
                icon: 'https://brave.com/favicon.ico',
                url: 'https://search.brave.com/search?q={query}'
            },
            'Yahoo': {
                name: 'Yahoo',
                icon: 'https://www.yahoo.com/favicon.ico',
                url: 'https://search.yahoo.com/search?p={query}'
            },
            'Yandex': {
                name: 'Yandex',
                icon: 'https://yandex.com/favicon.ico',
                url: 'https://yandex.com/search/?text={query}'
            },
            'Solar Search': {
                name: 'Solar Search',
                icon: 'https://raw.githubusercontent.com/solarbrowser/mobile/refs/heads/main/assets/icon.png',
                url: 'https://search.browser.solar/search?q={query}'
            }
        };        // Current search engine (will be updated from Flutter)
        let currentSearchEngine = 'Google';
        
        // News configuration - REAL API ONLY!
        const newsConfig = {
            url: 'https://firebasestorage.googleapis.com/v0/b/vertex-ai-1618.firebasestorage.app/o/public-cache%2Fnews.json?alt=media&token=c1553d29-fa55-4520-9bec-e1d3416be62a',
            fallbackUrl: 'https://firebasestorage.googleapis.com/v0/b/vertex-ai-1618.firebasestorage.app/o/public-cache%2Fnews.json?alt=media&token=c1553d29-fa55-4520-9bec-e1d3416be62a',            maxItems: 6,
            refreshInterval: 30 * 60 * 1000 // 30 minutes
        };
        
        // Localization data
        const localizations = {
            'ar': {
                news: 'أخبار فيرتكس',
                loading: 'جاري تحميل الأخبار...',
                error: 'فشل في تحميل الأخبار',
                searchPlaceholder: 'ابحث أو أدخل العنوان',
                addSite: 'إضافة موقع',
                readMore: 'اقرأ المزيد',
                showLess: 'عرض أقل',
                enterWebsiteUrl: 'أدخل عنوان الموقع (مثال: google.com):',
                enterShortcutTitle: 'أدخل عنوان الاختصار:',
                removeShortcutConfirm: 'إزالة "{title}" من الاختصارات؟'
            },
            'de': {
                news: 'Vertex Nachrichten',
                loading: 'Nachrichten laden...',
                error: 'Nachrichten konnten nicht geladen werden',
                searchPlaceholder: 'Suchen oder Adresse eingeben',
                addSite: 'Seite hinzufügen',
                readMore: 'Mehr lesen',
                showLess: 'Weniger anzeigen',
                enterWebsiteUrl: 'Website-URL eingeben (z.B. google.com):',
                enterShortcutTitle: 'Verknüpfungstitel eingeben:',
                removeShortcutConfirm: '"{title}" aus Verknüpfungen entfernen?'
            },
            'en': {
                news: 'Vertex News',
                loading: 'Loading news...',
                error: 'Failed to load news',
                searchPlaceholder: 'Search or enter address',
                addSite: 'Add Site',
                readMore: 'Read More',
                showLess: 'Show Less',
                enterWebsiteUrl: 'Enter website URL (e.g., google.com):',
                enterShortcutTitle: 'Enter shortcut title:',
                removeShortcutConfirm: 'Remove "{title}" from shortcuts?'
            },
            'es': {
                news: 'Noticias Vertex',
                loading: 'Cargando noticias...',
                error: 'Error al cargar noticias',
                searchPlaceholder: 'Buscar o ingresar dirección',
                addSite: 'Agregar Sitio',
                readMore: 'Leer Más',
                showLess: 'Mostrar Menos',
                enterWebsiteUrl: 'Ingrese URL del sitio web (ej: google.com):',
                enterShortcutTitle: 'Ingrese título del acceso directo:',
                removeShortcutConfirm: '¿Eliminar "{title}" de los accesos directos?'
            },
            'fr': {
                news: 'Actualités Vertex',
                loading: 'Chargement des actualités...',
                error: 'Échec du chargement des actualités',
                searchPlaceholder: 'Rechercher ou entrer une adresse',
                addSite: 'Ajouter un Site',
                readMore: 'Lire Plus',
                showLess: 'Afficher Moins',
                enterWebsiteUrl: 'Entrez l\'URL du site web (ex: google.com):',
                enterShortcutTitle: 'Entrez le titre du raccourci:',
                removeShortcutConfirm: 'Supprimer "{title}" des raccourcis?'
            },
            'hi': {
                news: 'वर्टेक्स समाचार',
                loading: 'समाचार लोड हो रहे हैं...',
                error: 'समाचार लोड करने में विफल',
                searchPlaceholder: 'खोजें या पता दर्ज करें',
                addSite: 'साइट जोड़ें',
                readMore: 'और पढ़ें',
                showLess: 'कम दिखाएं',
                enterWebsiteUrl: 'वेबसाइट URL दर्ज करें (जैसे: google.com):',
                enterShortcutTitle: 'शॉर्टकट शीर्षक दर्ज करें:',
                removeShortcutConfirm: 'शॉर्टकट से "{title}" हटाएं?'
            },
            'it': {
                news: 'Notizie Vertex',
                loading: 'Caricamento notizie...',
                error: 'Caricamento notizie fallito',
                searchPlaceholder: 'Cerca o inserisci indirizzo',
                addSite: 'Aggiungi Sito',
                readMore: 'Leggi di Più',
                showLess: 'Mostra Meno',
                enterWebsiteUrl: 'Inserisci URL del sito web (es: google.com):',
                enterShortcutTitle: 'Inserisci titolo collegamento:',
                removeShortcutConfirm: 'Rimuovere "{title}" dai collegamenti?'
            },
            'ja': {
                news: 'Vertexニュース',
                loading: 'ニュースを読み込み中...',
                error: 'ニュースの読み込みに失敗しました',
                searchPlaceholder: '検索またはアドレスを入力',
                addSite: 'サイトを追加',
                readMore: '続きを読む',
                showLess: '少なく表示',
                enterWebsiteUrl: 'ウェブサイトのURLを入力 (例: google.com):',
                enterShortcutTitle: 'ショートカットのタイトルを入力:',
                removeShortcutConfirm: 'ショートカットから"{title}"を削除しますか？'
            },
            'ko': {
                news: 'Vertex 뉴스',
                loading: '뉴스 로딩 중...',
                error: '뉴스 로드 실패',
                searchPlaceholder: '검색하거나 주소 입력',
                addSite: '사이트 추가',
                readMore: '더 읽기',
                showLess: '적게 보기',
                enterWebsiteUrl: '웹사이트 URL 입력 (예: google.com):',
                enterShortcutTitle: '바로가기 제목 입력:',
                removeShortcutConfirm: '바로가기에서 "{title}"을(를) 제거하시겠습니까?'
            },
            'pt': {
                news: 'Notícias Vertex',
                loading: 'Carregando notícias...',
                error: 'Falha ao carregar notícias',
                searchPlaceholder: 'Pesquisar ou inserir endereço',
                addSite: 'Adicionar Site',
                readMore: 'Ler Mais',
                showLess: 'Mostrar Menos',
                enterWebsiteUrl: 'Digite a URL do site (ex: google.com):',
                enterShortcutTitle: 'Digite o título do atalho:',
                removeShortcutConfirm: 'Remover "{title}" dos atalhos?'
            },
            'ru': {
                news: 'Новости Vertex',
                loading: 'Загрузка новостей...',
                error: 'Не удалось загрузить новости',
                searchPlaceholder: 'Поиск или введите адрес',
                addSite: 'Добавить Сайт',
                readMore: 'Читать Далее',
                showLess: 'Показать Меньше',
                enterWebsiteUrl: 'Введите URL сайта (например: google.com):',
                enterShortcutTitle: 'Введите название ярлыка:',
                removeShortcutConfirm: 'Удалить "{title}" из ярлыков?'
            },
            'tr': {
                news: 'Vertex Haberleri',
                loading: 'Haberler yükleniyor...',
                error: 'Haberler yüklenemedi',
                searchPlaceholder: 'Ara veya adres gir',
                addSite: 'Site Ekle',
                readMore: 'Devamını Oku',
                showLess: 'Daha Az Göster',
                enterWebsiteUrl: 'Website URL\'si girin (örn: google.com):',
                enterShortcutTitle: 'Kısayol başlığı girin:',
                removeShortcutConfirm: 'Kısayollardan "{title}" kaldırılsın mı?'
            },
            'zh': {
                news: 'Vertex 新闻',
                loading: '正在加载新闻...',
                error: '加载新闻失败',
                searchPlaceholder: '搜索或输入地址',
                addSite: '添加网站',
                readMore: '阅读更多',
                showLess: '显示较少',
                enterWebsiteUrl: '输入网站URL (例如: google.com):',
                enterShortcutTitle: '输入快捷方式标题:',
                removeShortcutConfirm: '从快捷方式中删除"{title}"？'
            }
        };

        // Current language and theme
        let currentLanguage = 'en';
        let currentTheme = {
            themeName: 'light',
            isDark: false,
            colors: {
                backgroundColor: '#ffffff',
                surfaceColor: '#f5f5f5',
                textColor: '#000000',
                textSecondaryColor: '#757575',
                primaryColor: '#2196f3',
                accentColor: '#1976d2',
                errorColor: '#f44336',
                successColor: '#4caf50',
                warningColor: '#ff9800',
                secondaryColor: '#e0e0e0'
            }
        };

        // Helper functions
        function getLocalizedText(key) {
            return localizations[currentLanguage]?.[key] || localizations['en'][key] || key;
        }

        function updateSearchEngineLogo() {
            const engine = searchEngines[currentSearchEngine] || searchEngines['Google'];
            const iconImg = document.getElementById('searchEngineIcon');
            if (iconImg) {
                iconImg.src = engine.icon;
                iconImg.alt = engine.name;                iconImg.onerror = function() {
                    console.log('Failed to load search engine icon, using fallback');
                    this.src = 'https://www.google.com/favicon.ico';
                };
            }
            console.log('🔍 Updated search engine logo:', currentSearchEngine, engine.icon);
        }

        function updateLocalizedUI() {
            // Update news section
            const newsTitle = document.getElementById('newsTitle');
            if (newsTitle) {
                newsTitle.textContent = getLocalizedText('news');
            }

            // Update search placeholder
            const searchBox = document.querySelector('.search-box');
            if (searchBox) {
                searchBox.placeholder = getLocalizedText('searchPlaceholder');
            }

            // Update "Add Site" text
            const addSiteText = document.getElementById('addSiteText');
            if (addSiteText) {
                addSiteText.textContent = getLocalizedText('addSite');
            }            // Update any existing "Add Site" elements created dynamically
            const addSiteElements = document.querySelectorAll('.shortcut-item.add-new .shortcut-title');
            addSiteElements.forEach(element => {
                element.textContent = getLocalizedText('addSite');
            });

            console.log('🌐 Updated localized UI for language:', currentLanguage);
        }

        // News fetching and rendering - NOW USING FLUTTER HANDLER!
        let isNewsFetching = false;

        async function fetchNews() {
            if (isNewsFetching) {
                console.log('📰 News fetch already in progress, skipping...');
                return;
            }
            
            isNewsFetching = true;
            console.log('📰 Fetching REAL news via Flutter NewsHandler...');
            console.log('📰 News config URL:', newsConfig.url);
            console.log('📰 News config fallback URL:', newsConfig.fallbackUrl);
            
            const newsContent = document.getElementById('newsContent');
            const loadingDiv = document.getElementById('newsLoading');
            
            if (loadingDiv) {
                loadingDiv.textContent = getLocalizedText('loading');
                console.log('📰 Loading text set to:', getLocalizedText('loading'));
            }

            try {
                // Use Flutter NewsHandler for proper Uri.parse() handling
                if (window.NewsHandler && window.NewsHandler.postMessage) {
                    console.log('📰 ✅ NewsHandler available! Using Flutter to fetch news...');
                    window.NewsHandler.postMessage('fetchNews');
                    console.log('📰 📤 Sent fetchNews message to Flutter NewsHandler');
                } else {
                    console.log('📰 ❌ NewsHandler not available, falling back to JavaScript fetch');
                    console.log('📰 🔄 Attempting to fetch from fallback URL...');
                    // Fallback to JavaScript fetch
                    await fetchNewsFromUrl(newsConfig.fallbackUrl, false);
                }
                
            } catch (error) {
                console.error('❌ Error in fetchNews:', error);                // Show sample news as last resort
                console.log('📰 🆘 Using sample news as last resort');
                const sampleNews = [
                    {
                        id: 'sample-1',
                        translations: {
                            ar: {
                                title: 'مرحباً بك في متصفح Solar',
                                summary: 'متصفح الويب السريع والآمن والخاص بك. يوفر متصفح Solar ميزات خصوصية متقدمة وسرعات تصفح فائقة وواجهة نظيفة مصممة لمستخدم الويب الحديث.',
                                content: 'متصفح الويب السريع والآمن والخاص بك. يوفر متصفح Solar ميزات خصوصية متقدمة وسرعات تصفح فائقة وواجهة نظيفة مصممة لمستخدم الويب الحديث. ابق على اطلاع بأحدث الأخبار والمقالات من جميع أنحاء العالم. يتضمن متصفحنا حظر الإعلانات المدمج وحماية التتبع وأوضاع التصفح الآمن لضمان خصوصيتك وأمانك عبر الإنترنت. اختبر الويب كما لم تفعل من قبل مع متصفح Solar - حيث تلتقي السرعة بالأمان وتأتي الخصوصية أولاً.'
                            },
                            de: {
                                title: 'Willkommen bei Solar Browser',
                                summary: 'Ihr schneller, sicherer und privater Webbrowser. Solar Browser bietet erweiterte Datenschutzfunktionen, blitzschnelle Browsing-Geschwindigkeiten und eine saubere Benutzeroberfläche für moderne Webnutzer.',
                                content: 'Ihr schneller, sicherer und privater Webbrowser. Solar Browser bietet erweiterte Datenschutzfunktionen, blitzschnelle Browsing-Geschwindigkeiten und eine saubere Benutzeroberfläche für moderne Webnutzer. Bleiben Sie mit den neuesten Nachrichten und Artikeln aus aller Welt auf dem Laufenden. Unser Browser enthält eingebaute Werbeblockierung, Tracking-Schutz und sichere Browsing-Modi, um Ihre Online-Privatsphäre und Sicherheit zu gewährleisten.'
                            },
                            en: {
                                title: 'Welcome to Solar Browser',
                                summary: 'Your fast, secure and private web browser. Solar Browser offers advanced privacy features, lightning-fast browsing speeds, and a clean interface designed for the modern web user.',
                                content: 'Your fast, secure and private web browser. Solar Browser offers advanced privacy features, lightning-fast browsing speeds, and a clean interface designed for the modern web user. Stay updated with the latest news and articles from around the world. Our browser includes built-in ad blocking, tracking protection, and secure browsing modes to ensure your online privacy and safety. Experience the web like never before with Solar Browser - where speed meets security and privacy comes first. With customizable themes, advanced bookmark management, and intelligent search features, Solar Browser provides everything you need for a superior browsing experience. Our commitment to user privacy means no tracking, no data collection, and complete control over your digital footprint.'
                            },
                            es: {
                                title: 'Bienvenido a Solar Browser',
                                summary: 'Tu navegador web rápido, seguro y privado. Solar Browser ofrece características avanzadas de privacidad, velocidades de navegación ultrarrápidas y una interfaz limpia diseñada para el usuario web moderno.',
                                content: 'Tu navegador web rápido, seguro y privado. Solar Browser ofrece características avanzadas de privacidad, velocidades de navegación ultrarrápidas y una interfaz limpia diseñada para el usuario web moderno. Mantente actualizado con las últimas noticias y artículos de todo el mundo. Nuestro navegador incluye bloqueo de anuncios integrado, protección contra rastreo y modos de navegación segura para garantizar tu privacidad y seguridad en línea.'
                            },
                            fr: {
                                title: 'Bienvenue sur Solar Browser',
                                summary: 'Votre navigateur web rapide, sécurisé et privé. Solar Browser offre des fonctionnalités de confidentialité avancées, des vitesses de navigation ultra-rapides et une interface propre conçue pour l\'utilisateur web moderne.',
                                content: 'Votre navigateur web rapide, sécurisé et privé. Solar Browser offre des fonctionnalités de confidentialité avancées, des vitesses de navigation ultra-rapides et une interface propre conçue pour l\'utilisateur web moderne. Restez informé avec les dernières actualités et articles du monde entier. Notre navigateur inclut un blocage de publicités intégré, une protection contre le pistage et des modes de navigation sécurisés pour garantir votre vie privée et sécurité en ligne.'
                            },
                            hi: {
                                title: 'Solar Browser में आपका स्वागत है',
                                summary: 'आपका तेज़, सुरक्षित और निजी वेब ब्राउज़र। Solar Browser उन्नत गोपनीयता सुविधाएं, बिजली-तेज़ ब्राउज़िंग गति, और आधुनिक वेब उपयोगकर्ता के लिए डिज़ाइन किया गया साफ इंटरफेस प्रदान करता है।',
                                content: 'आपका तेज़, सुरक्षित और निजी वेब ब्राउज़र। Solar Browser उन्नत गोपनीयता सुविधाएं, बिजली-तेज़ ब्राउज़िंग गति, और आधुनिक वेब उपयोगकर्ता के लिए डिज़ाइन किया गया साफ इंटरफेस प्रदान करता है। दुनिया भर से नवीनतम समाचार और लेखों के साथ अपडेट रहें। हमारे ब्राउज़र में आपकी ऑनलाइन गोपनीयता और सुरक्षा सुनिश्चित करने के लिए अंतर्निहित विज्ञापन अवरोधन, ट्रैकिंग सुरक्षा, और सुरक्षित ब्राउज़िंग मोड शामिल हैं।'
                            },
                            it: {
                                title: 'Benvenuto in Solar Browser',
                                summary: 'Il tuo browser web veloce, sicuro e privato. Solar Browser offre funzionalità avanzate per la privacy, velocità di navigazione fulminee e un\'interfaccia pulita progettata per l\'utente web moderno.',
                                content: 'Il tuo browser web veloce, sicuro e privato. Solar Browser offre funzionalità avanzate per la privacy, velocità di navigazione fulminee e un\'interfaccia pulita progettata per l\'utente web moderno. Rimani aggiornato con le ultime notizie e articoli da tutto il mondo. Il nostro browser include blocco annunci integrato, protezione dal tracciamento e modalità di navigazione sicura per garantire la tua privacy e sicurezza online.'
                            },
                            ja: {
                                title: 'Solar Browserへようこそ',
                                summary: '高速で安全なプライベートWebブラウザ。Solar Browserは、高度なプライバシー機能、超高速ブラウジング速度、モダンなWebユーザー向けに設計されたクリーンなインターフェースを提供します。',
                                content: '高速で安全なプライベートWebブラウザ。Solar Browserは、高度なプライバシー機能、超高速ブラウジング速度、モダンなWebユーザー向けに設計されたクリーンなインターフェースを提供します。世界中の最新ニュースや記事で最新情報を入手してください。私たちのブラウザには、オンラインプライバシーと安全性を確保するための組み込み広告ブロック、トラッキング保護、セキュアブラウジングモードが含まれています。'
                            },
                            ko: {
                                title: 'Solar Browser에 오신 것을 환영합니다',
                                summary: '빠르고 안전하며 프라이빗한 웹 브라우저입니다. Solar Browser는 고급 개인정보 보호 기능, 초고속 브라우징 속도, 현대적인 웹 사용자를 위해 설계된 깔끔한 인터페이스를 제공합니다.',
                                content: '빠르고 안전하며 프라이빗한 웹 브라우저입니다. Solar Browser는 고급 개인정보 보호 기능, 초고속 브라우징 속도, 현대적인 웹 사용자를 위해 설계된 깔끔한 인터페이스를 제공합니다. 전 세계의 최신 뉴스와 기사로 최신 정보를 받아보세요. 저희 브라우저에는 온라인 개인정보 보호와 안전을 보장하기 위한 내장 광고 차단, 추적 보호, 보안 브라우징 모드가 포함되어 있습니다.'
                            },
                            pt: {
                                title: 'Bem-vindo ao Solar Browser',
                                summary: 'Seu navegador web rápido, seguro e privado. O Solar Browser oferece recursos avançados de privacidade, velocidades de navegação ultrarrápidas e uma interface limpa projetada para o usuário web moderno.',
                                content: 'Seu navegador web rápido, seguro e privado. O Solar Browser oferece recursos avançados de privacidade, velocidades de navegação ultrarrápidas e uma interface limpa projetada para o usuário web moderno. Mantenha-se atualizado com as últimas notícias e artigos de todo o mundo. Nosso navegador inclui bloqueio de anúncios integrado, proteção contra rastreamento e modos de navegação segura para garantir sua privacidade e segurança online.'
                            },
                            ru: {
                                title: 'Добро пожаловать в Solar Browser',
                                summary: 'Ваш быстрый, безопасный и приватный веб-браузер. Solar Browser предлагает продвинутые функции конфиденциальности, молниеносную скорость просмотра и чистый интерфейс, разработанный для современного пользователя.',
                                content: 'Ваш быстрый, безопасный и приватный веб-браузер. Solar Browser предлагает продвинутые функции конфиденциальности, молниеносную скорость просмотра и чистый интерфейс, разработанный для современного пользователя. Оставайтесь в курсе последних новостей и статей со всего мира. Наш браузер включает встроенную блокировку рекламы, защиту от отслеживания и безопасные режимы просмотра для обеспечения вашей конфиденциальности и безопасности в Интернете.'
                            },
                            tr: {
                                title: 'Solar Browser\'a Hoş Geldiniz',
                                summary: 'Hızlı, güvenli ve gizli web tarayıcınız. Solar Browser gelişmiş gizlilik özellikleri, yıldırım hızında gezinme ve modern web kullanıcısı için tasarlanmış temiz bir arayüz sunar.',
                                content: 'Hızlı, güvenli ve gizli web tarayıcınız. Solar Browser gelişmiş gizlilik özellikleri, yıldırım hızında gezinme ve modern web kullanıcısı için tasarlanmış temiz bir arayüz sunar. Dünyanın dört bir yanından en son haberler ve makalelerle güncel kalın. Tarayıcımız çevrimiçi gizliliğinizi ve güvenliğinizi sağlamak için yerleşik reklam engelleme, izleme koruması ve güvenli gezinme modları içerir. Özelleştirilebilir temalar, gelişmiş yer imi yönetimi ve akıllı arama özellikleri ile Solar Browser üstün bir gezinme deneyimi için ihtiyacınız olan her şeyi sağlar.'
                            },
                            zh: {
                                title: '欢迎使用 Solar Browser',
                                summary: '您快速、安全且私密的网络浏览器。Solar Browser 提供先进的隐私功能、闪电般快速的浏览速度，以及为现代网络用户设计的简洁界面。',
                                content: '您快速、安全且私密的网络浏览器。Solar Browser 提供先进的隐私功能、闪电般快速的浏览速度，以及为现代网络用户设计的简洁界面。通过来自世界各地的最新新闻和文章保持更新。我们的浏览器包含内置广告拦截、跟踪保护和安全浏览模式，以确保您的在线隐私和安全。'
                            }
                        },
                        cover: {
                            en: 'https://picsum.photos/300/200?random=1'
                        },
                        references: ['https://browser.solar'],
                        publishedAt: new Date().toISOString()
                    },
                    {
                        id: 'sample-2',
                        translations: {
                            ar: {
                                title: 'ميزات الخصوصية المتقدمة',
                                summary: 'اكتشف كيف يحمي متصفح Solar بصمتك الرقمية بتقنية الخصوصية المتطورة. يطبق متصفحنا حماية متقدمة من التتبع وDNS آمن واتصالات مشفرة.',
                                content: 'اكتشف كيف يحمي متصفح Solar بصمتك الرقمية بتقنية الخصوصية المتطورة. يطبق متصفحنا حماية متقدمة من التتبع وDNS آمن واتصالات مشفرة للحفاظ على بيانات التصفح الخاصة بك آمنة من أعين المتطفلين. مع ميزات مثل إدارة ملفات تعريف الارتباط التلقائية وحظر بصمات الأصابع وتكامل VPN، يمكنك تصفح الويب بثقة مع العلم أن خصوصيتك هي أولويتنا القصوى.'
                            },
                            de: {
                                title: 'Erweiterte Datenschutzfunktionen',
                                summary: 'Entdecken Sie, wie Solar Browser Ihren digitalen Fußabdruck mit modernster Datenschutztechnologie schützt. Unser Browser implementiert erweiterten Tracking-Schutz, sicheres DNS und verschlüsselte Verbindungen.',
                                content: 'Entdecken Sie, wie Solar Browser Ihren digitalen Fußabdruck mit modernster Datenschutztechnologie schützt. Unser Browser implementiert erweiterten Tracking-Schutz, sicheres DNS und verschlüsselte Verbindungen, um Ihre Browsing-Daten vor neugierigen Blicken zu schützen. Mit Funktionen wie automatischem Cookie-Management, Fingerprint-Blockierung und VPN-Integration können Sie das Web mit dem Vertrauen durchsuchen, dass Ihre Privatsphäre unsere oberste Priorität ist.'
                            },
                            en: {
                                title: 'Advanced Privacy Features',
                                summary: 'Discover how Solar Browser protects your digital footprint with cutting-edge privacy technology. Our browser implements advanced tracking protection, secure DNS, and encrypted connections.',
                                content: 'Discover how Solar Browser protects your digital footprint with cutting-edge privacy technology. Our browser implements advanced tracking protection, secure DNS, and encrypted connections to keep your browsing data safe from prying eyes. With features like automatic cookie management, fingerprint blocking, and VPN integration, you can browse the web with confidence knowing your privacy is our top priority. Solar Browser uses state-of-the-art encryption protocols to secure your data transmission, prevents websites from tracking your activities across different sites, and provides comprehensive protection against malicious scripts and advertisements. Our privacy-first approach ensures that your personal information remains private and secure at all times.'
                            },
                            es: {
                                title: 'Características Avanzadas de Privacidad',
                                summary: 'Descubre cómo Solar Browser protege tu huella digital con tecnología de privacidad de vanguardia. Nuestro navegador implementa protección avanzada contra el rastreo, DNS seguro y conexiones encriptadas.',
                                content: 'Descubre cómo Solar Browser protege tu huella digital con tecnología de privacidad de vanguardia. Nuestro navegador implementa protección avanzada contra el rastreo, DNS seguro y conexiones encriptadas para mantener tus datos de navegación seguros de miradas indiscretas. Con características como gestión automática de cookies, bloqueo de huellas digitales e integración VPN, puedes navegar por la web con confianza sabiendo que tu privacidad es nuestra máxima prioridad.'
                            },
                            fr: {
                                title: 'Fonctionnalités Avancées de Confidentialité',
                                summary: 'Découvrez comment Solar Browser protège votre empreinte numérique avec une technologie de confidentialité de pointe. Notre navigateur implémente une protection avancée contre le pistage, un DNS sécurisé et des connexions chiffrées.',
                                content: 'Découvrez comment Solar Browser protège votre empreinte numérique avec une technologie de confidentialité de pointe. Notre navigateur implémente une protection avancée contre le pistage, un DNS sécurisé et des connexions chiffrées pour garder vos données de navigation à l\'abri des regards indiscrets. Avec des fonctionnalités comme la gestion automatique des cookies, le blocage d\'empreintes digitales et l\'intégration VPN, vous pouvez naviguer sur le web en toute confiance en sachant que votre vie privée est notre priorité absolue.'
                            },
                            hi: {
                                title: 'उन्नत गोपनीयता सुविधाएं',
                                summary: 'जानें कि कैसे Solar Browser अत्याधुनिक गोपनीयता तकनीक के साथ आपके डिजिटल फुटप्रिंट की सुरक्षा करता है। हमारा ब्राउज़र उन्नत ट्रैकिंग सुरक्षा, सुरक्षित DNS, और एन्क्रिप्टेड कनेक्शन लागू करता है।',
                                content: 'जानें कि कैसे Solar Browser अत्याधुनिक गोपनीयता तकनीक के साथ आपके डिजिटल फुटप्रिंट की सुरक्षा करता है। हमारा ब्राउज़र उन्नत ट्रैकिंग सुरक्षा, सुरक्षित DNS, और एन्क्रिप्टेड कनेक्शन लागू करता है ताकि आपका ब्राउज़िंग डेटा चुभती नज़रों से सुरक्षित रहे। स्वचालित कुकी प्रबंधन, फिंगरप्रिंट ब्लॉकिंग, और VPN एकीकरण जैसी सुविधाओं के साथ, आप यह जानते हुए विश्वास के साथ वेब ब्राउज़ कर सकते हैं कि आपकी गोपनीयता हमारी सर्वोच्च प्राथमिकता है।'
                            },
                            it: {
                                title: 'Funzionalità Avanzate per la Privacy',
                                summary: 'Scopri come Solar Browser protegge la tua impronta digitale con tecnologia di privacy all\'avanguardia. Il nostro browser implementa protezione avanzata dal tracciamento, DNS sicuro e connessioni crittografate.',
                                content: 'Scopri come Solar Browser protegge la tua impronta digitale con tecnologia di privacy all\'avanguardia. Il nostro browser implementa protezione avanzata dal tracciamento, DNS sicuro e connessioni crittografate per mantenere i tuoi dati di navigazione al sicuro da occhi indiscreti. Con funzionalità come gestione automatica dei cookie, blocco delle impronte digitali e integrazione VPN, puoi navigare sul web con fiducia sapendo che la tua privacy è la nostra massima priorità.'
                            },
                            ja: {
                                title: '高度なプライバシー機能',
                                summary: 'Solar Browserが最先端のプライバシー技術でデジタルフットプリントをどのように保護するかをご覧ください。私たちのブラウザは、高度なトラッキング保護、セキュアDNS、暗号化接続を実装しています。',
                                content: 'Solar Browserが最先端のプライバシー技術でデジタルフットプリントをどのように保護するかをご覧ください。私たちのブラウザは、高度なトラッキング保護、セキュアDNS、暗号化接続を実装して、ブラウジングデータを詮索好きな目から安全に保ちます。自動クッキー管理、フィンガープリントブロッキング、VPN統合などの機能により、プライバシーが最優先であることを知って安心してWebを閲覧できます。'
                            },
                            ko: {
                                title: '고급 개인정보 보호 기능',
                                summary: 'Solar Browser가 최첨단 개인정보 보호 기술로 디지털 발자국을 어떻게 보호하는지 알아보세요. 저희 브라우저는 고급 추적 보호, 보안 DNS, 암호화된 연결을 구현합니다.',
                                content: 'Solar Browser가 최첨단 개인정보 보호 기술로 디지털 발자국을 어떻게 보호하는지 알아보세요. 저희 브라우저는 고급 추적 보호, 보안 DNS, 암호화된 연결을 구현하여 브라우징 데이터를 엿보는 눈으로부터 안전하게 보호합니다. 자동 쿠키 관리, 지문 차단, VPN 통합과 같은 기능을 통해 개인정보 보호가 최우선임을 알고 안심하고 웹을 탐색할 수 있습니다.'
                            },
                            pt: {
                                title: 'Recursos Avançados de Privacidade',
                                summary: 'Descubra como o Solar Browser protege sua pegada digital com tecnologia de privacidade de ponta. Nosso navegador implementa proteção avançada contra rastreamento, DNS seguro e conexões criptografadas.',
                                content: 'Descubra como o Solar Browser protege sua pegada digital com tecnologia de privacidade de ponta. Nosso navegador implementa proteção avançada contra rastreamento, DNS seguro e conexões criptografadas para manter seus dados de navegação seguros de olhos curiosos. Com recursos como gerenciamento automático de cookies, bloqueio de impressão digital e integração VPN, você pode navegar na web com confiança sabendo que sua privacidade é nossa principal prioridade.'
                            },
                            ru: {
                                title: 'Продвинутые Функции Конфиденциальности',
                                summary: 'Узнайте, как Solar Browser защищает ваш цифровой след с помощью передовых технологий конфиденциальности. Наш браузер реализует расширенную защиту от отслеживания, безопасный DNS и зашифрованные соединения.',
                                content: 'Узнайте, как Solar Browser защищает ваш цифровой след с помощью передовых технологий конфиденциальности. Наш браузер реализует расширенную защиту от отслеживания, безопасный DNS и зашифрованные соединения, чтобы защитить ваши данные просмотра от посторонних глаз. С такими функциями, как автоматическое управление файлами cookie, блокировка отпечатков пальцев и интеграция VPN, вы можете просматривать веб-страницы с уверенностью, зная, что ваша конфиденциальность является нашим главным приоритетом.'
                            },
                            tr: {
                                title: 'Gelişmiş Gizlilik Özellikleri',
                                summary: 'Solar Browser\'ın en son gizlilik teknolojisiyle dijital ayak izinizi nasıl koruduğunu keşfedin. Tarayıcımız gelişmiş izleme koruması, güvenli DNS ve şifreli bağlantılar uygular.',
                                content: 'Solar Browser\'ın en son gizlilik teknolojisiyle dijital ayak izinizi nasıl koruduğunu keşfedin. Tarayıcımız, gezinme verilerinizi meraklı gözlerden güvende tutmak için gelişmiş izleme koruması, güvenli DNS ve şifreli bağlantılar uygular. Otomatik çerez yönetimi, parmak izi engelleme ve VPN entegrasyonu gibi özelliklerle, gizliliğinizin önceliğimiz olduğunu bilerek güvenle web\'de gezinebilirsiniz.'
                            },
                            zh: {
                                title: '高级隐私功能',
                                summary: '了解 Solar Browser 如何使用尖端隐私技术保护您的数字足迹。我们的浏览器实现了高级跟踪保护、安全 DNS 和加密连接。',
                                content: '了解 Solar Browser 如何使用尖端隐私技术保护您的数字足迹。我们的浏览器实现了高级跟踪保护、安全 DNS 和加密连接，以保护您的浏览数据免受窥探。通过自动 cookie 管理、指纹阻止和 VPN 集成等功能，您可以放心地浏览网络，因为您知道您的隐私是我们的首要任务。'
                            }
                        },
                        cover: {
                            en: 'https://picsum.photos/300/200?random=2'
                        },
                        references: ['https://browser.solar/privacy'],
                        publishedAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()
                    }
                ];
                
                renderNews(sampleNews);            } finally {
                isNewsFetching = false;
                console.log('📰 News fetch completed, isNewsFetching set to false');
            }
        }

        async function fetchNewsFromUrl(url, isFallback = false) {
            const now = Date.now();
            const urlWithCacheBuster = `${url}${url.includes('?') ? '&' : '?'}v=${now}&cb=${Math.random()}`;
            
            console.log('📰 Fetching from URL:', urlWithCacheBuster);
            
            const response = await fetch(urlWithCacheBuster, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'User-Agent': 'Solar Browser/1.0',
                    'X-Master-Key': '$2a$10$7H.P9/dBKGvCKMM/qJXZKOq.OYT9Vd/sMNJCkB8rPG8KG8HrKKvj.'
                },
                mode: 'cors',
                cache: 'no-store' // Force no cache
            });

            console.log('📰 Response status:', response.status, response.statusText);

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const responseText = await response.text();
            console.log('📰 Raw response (first 500 chars):', responseText.substring(0, 500));

            let newsData;
            try {
                const parsedResponse = JSON.parse(responseText);
                  if (isFallback) {
                    // JSONPlaceholder format - convert to our format
                    console.log('📰 Converting JSONPlaceholder format');
                    const articles = parsedResponse.slice(0, newsConfig.maxItems).map((item, index) => ({
                        id: item.id || `fallback-${index}`,
                        translations: {
                            en: {
                                title: item.title || `News ${index + 1}`,
                                summary: item.body || 'No summary available. This is a sample news article with extended content to demonstrate the expand/collapse functionality. Click "Read More" to see how the news expands to show the full article content.'
                            },
                            tr: {
                                title: `Haber ${index + 1}`,
                                summary: 'Bu bir örnek haber içeriğidir. Genişletme ve daraltma işlevselliğini göstermek için uzun içerik örneği. Tam makale içeriğini görmek için "Devamını Oku" düğmesine tıklayın.'
                            }
                        },
                        cover: {
                            en: `https://picsum.photos/300/200?random=${item.id || index}`
                        },
                        references: [`https://jsonplaceholder.typicode.com/posts/${item.id || index}`],
                        publishedAt: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString()
                    }));
                    newsData = { articles };
                } else {
                    // Check if response has record property (JSONBin format)
                    if (parsedResponse.record && Array.isArray(parsedResponse.record)) {
                        newsData = { articles: parsedResponse.record };
                    } else if (Array.isArray(parsedResponse)) {
                        newsData = { articles: parsedResponse };
                    } else {
                        newsData = parsedResponse;
                    }
                }
            } catch (parseError) {
                console.error('❌ JSON parse error:', parseError);
                console.error('❌ Raw response that failed to parse:', responseText);
                throw new Error('Invalid JSON response: ' + parseError.message);
            }

            console.log('📰 Parsed news data:', newsData);
            console.log('📰 Number of articles:', newsData.articles ? newsData.articles.length : 0);

            // Handle the response format
            let articles = [];
            if (newsData.articles) {
                articles = newsData.articles;
                console.log('📰 Found', articles.length, 'articles in response');
            } else {
                console.log('📰 No articles array found in response');
            }            // Cache the news
            localStorage.setItem('solarNews', JSON.stringify(articles));
            localStorage.setItem('solarNewsTime', now.toString());
            console.log('📰 Cached', articles.length, 'articles with timestamp:', now);
            console.log('✅ News data processed and cached, rendering now...');
            renderNews(articles);
        }

        function renderNews(newsData) {
            console.log('📰 renderNews called with:', newsData);
            const newsContent = document.getElementById('newsContent');
            if (!newsContent) {
                console.error('❌ newsContent element not found!');
                return;
            }

            // Handle different JSON structures
            let articles = [];
            if (Array.isArray(newsData)) {
                articles = newsData;
                console.log('📰 newsData is array, length:', articles.length);
            } else if (newsData.articles) {
                articles = newsData.articles;
                console.log('📰 newsData has articles property, length:', articles.length);
            } else {
                console.log('📰 newsData format not recognized:', typeof newsData, newsData);
            }

            if (!articles || articles.length === 0) {
                console.log('📰 No articles to render, showing error');
                renderNewsError('No news available');
                return;
            }

            // Limit to maxItems
            articles = articles.slice(0, newsConfig.maxItems);
            console.log('📰 Rendering', articles.length, 'articles');

            const newsGrid = document.createElement('div');
            newsGrid.className = 'news-grid';

            let renderedCount = 0;
            articles.forEach((article, index) => {
                console.log('📰 Processing article', index, ':', article);
                const newsItem = createNewsItem(article);
                if (newsItem) {
                    newsGrid.appendChild(newsItem);
                    renderedCount++;
                    console.log('📰 Successfully rendered article', index);
                } else {
                    console.log('📰 Failed to create news item for article', index);
                }
            });

            newsContent.innerHTML = '';
            newsContent.appendChild(newsGrid);
              console.log('✅ Rendered', renderedCount, 'REAL news items out of', articles.length, 'articles');
        }

        function createNewsItem(article) {
            // Handle the Firebase news format with translations
            let title, summary, fullContent, imageUrl, url, publishedAt;
            
            if (article.translations) {
                // Get content based on current language
                const lang = currentLanguage === 'tr' ? 'tr' : 'en';
                const translation = article.translations[lang] || article.translations.en;
                title = translation?.title || 'Untitled';
                
                // Get BOTH summary and content - use content for full expansion, summary for preview
                summary = translation?.summary || '';
                fullContent = translation?.content || translation?.summary || '';
                
                // If we have both summary and content, use summary for truncated view
                if (translation?.content && translation?.summary) {
                    // Use summary for initial display, content for expansion
                    console.log('📰 Found both summary and content for:', title);
                } else {
                    // Use whatever we have for both
                    summary = fullContent;
                }
                
                // Get image URL based on language
                if (article.cover) {
                    imageUrl = article.cover[lang] || article.cover.en || '';
                }
                
                publishedAt = article.publishedAt || '';
            } else {
                // Simple format fallback
                title = article.title || 'Untitled';
                summary = article.summary || article.body || '';
                fullContent = article.content || article.summary || article.body || '';
                imageUrl = article.image || '';
                publishedAt = article.publishedAt || '';
            }            if (!title) return null;

            // Create truncated version for initial display using summary
            const truncateLimit = 200;
            const displayText = summary || fullContent; // Use summary first, then fallback to content
            const shouldTruncate = displayText.length > truncateLimit;
            const truncatedSummary = shouldTruncate 
                ? displayText.substring(0, truncateLimit) + '...' 
                : displayText;

            console.log('📰 News item:', title);
            console.log('📰 Summary length:', summary?.length || 0);
            console.log('📰 Full content length:', fullContent?.length || 0);
            console.log('📰 Will show truncated?', shouldTruncate);// Create non-clickable container - NO NAVIGATION!
            const newsItem = document.createElement('div');
            newsItem.className = 'news-item';
            newsItem.style.cursor = 'default'; // Explicitly no pointer cursor
            
            // Prevent any clicks from navigating
            newsItem.onclick = function(e) {
                // Only allow expand/collapse button clicks
                if (!e.target.classList.contains('news-item-expand')) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            };
            
            // Create unique ID for this news item
            const itemId = 'news-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            newsItem.id = itemId;

            const imageHtml = imageUrl 
                ? `<img src="${imageUrl}" alt="${title}" class="news-item-image" onerror="this.style.display='none';">`
                : `<div class="news-item-image" style="background: var(--color-secondary); display: flex; align-items: center; justify-content: center; color: var(--text-secondary); font-size: 24px;">📰</div>`;

            const timeAgo = publishedAt ? formatTimeAgo(new Date(publishedAt)) : '';            // Clean and escape content for data attributes - NO SOURCE ADDED!
            const cleanFullContent = (fullContent || '').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
            const cleanTruncatedContent = (truncatedSummary || '').replace(/"/g, '&quot;').replace(/'/g, '&#39;');            // Create the expand button - only if we have more content to show
            const hasMoreContent = fullContent && fullContent.length > truncateLimit;
            const expandButtonHtml = hasMoreContent
                ? `<div class="news-item-expand" onclick="toggleNewsExpansion('${itemId}')">${getLocalizedText('readMore')}</div>` 
                : '';

            console.log('📰 Has more content?', hasMoreContent);
            console.log('📰 Show expand button?', !!expandButtonHtml);

            newsItem.innerHTML = `
                ${imageHtml}
                <div class="news-item-title">${title}</div>
                <div class="news-item-summary" data-full="${cleanFullContent}" data-truncated="${cleanTruncatedContent}">${truncatedSummary}</div>
                ${expandButtonHtml}
                <div class="news-item-source">
                    <span>Vertex News</span>
                    ${timeAgo ? `<span>• ${timeAgo}</span>` : ''}
                </div>
            `;

            return newsItem;
        }

        // Function to toggle news expansion
        function toggleNewsExpansion(itemId) {
            const newsItem = document.getElementById(itemId);
            if (!newsItem) return;
            
            const summaryElement = newsItem.querySelector('.news-item-summary');
            const expandButton = newsItem.querySelector('.news-item-expand');
            
            if (!summaryElement || !expandButton) return;
            
            const fullContent = summaryElement.getAttribute('data-full').replace(/&quot;/g, '"').replace(/&#39;/g, "'");
            const truncatedContent = summaryElement.getAttribute('data-truncated').replace(/&quot;/g, '"').replace(/&#39;/g, "'");
            const isExpanded = summaryElement.classList.contains('expanded');
            
            if (isExpanded) {
                // Collapse
                summaryElement.classList.remove('expanded');
                // Convert back to truncated content without extra formatting
                const originalTruncated = truncatedContent.split('\n\nSource:')[0];
                summaryElement.innerHTML = originalTruncated.replace(/\n/g, '<br>');
                expandButton.innerHTML = getLocalizedText('readMore');
                console.log('📰 News collapsed');
            } else {
                // Expand
                summaryElement.classList.add('expanded');
                // Show full content with proper line breaks
                summaryElement.innerHTML = fullContent.replace(/\n/g, '<br>');
                expandButton.innerHTML = getLocalizedText('showLess');
                console.log('📰 News expanded, full content length:', fullContent.length);
                
                // Smooth scroll to ensure the expanded content is visible
                setTimeout(() => {
                    expandButton.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'nearest' 
                    });
                }, 100);
            }
        }

        function formatTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return `${diffInSeconds}s ago`;
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            return `${Math.floor(diffInSeconds / 86400)}d ago`;
        }

        function renderNewsError(message = null) {
            const newsContent = document.getElementById('newsContent');
            if (!newsContent) return;

            const errorText = message || getLocalizedText('error');
            newsContent.innerHTML = `<div class="news-error">${errorText}</div>`;
        }

        // Search functionality
        document.querySelector('.search-box').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const query = this.value.trim();
                console.log('Search query entered:', query);
                
                if (query) {
                    // Check if it looks like a URL
                    if (query.includes('.') && !query.includes(' ')) {
                        const url = query.startsWith('http') ? query : `https://${query}`;
                        console.log('Navigating to URL:', url);
                        window.location.href = url;
                    } else {
                        // It's a search query
                        console.log('Sending search query to Flutter');
                        if (window.SearchHandler && window.SearchHandler.postMessage) {
                            window.SearchHandler.postMessage(query);
                        } else {
                            // Fallback to Google
                            const fallbackUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                            window.location.href = fallbackUrl;
                        }
                    }
                }
            }
        });

        // Get favicon URL for a website
        function getFaviconUrl(url) {
            try {
                const domain = new URL(url.startsWith('http') ? url : 'https://' + url).hostname;
                return `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;
            } catch (e) {
                return '';
            }
        }

        // Render shortcuts
        function renderShortcuts() {
            const grid = document.getElementById('shortcutsGrid');
            
            // Clear existing shortcuts except add button
            grid.innerHTML = '';
            
            // Add existing shortcuts
            shortcuts.forEach((shortcut, index) => {
                const shortcutElement = document.createElement('a');
                shortcutElement.className = 'shortcut-item';
                shortcutElement.href = shortcut.url.startsWith('http') ? shortcut.url : 'https://' + shortcut.url;
                shortcutElement.onclick = function(e) {
                    e.preventDefault();
                    window.location.href = this.href;
                };
                
                const faviconUrl = getFaviconUrl(shortcut.url);
                shortcutElement.innerHTML = `
                    <div class="shortcut-menu" onclick="event.stopPropagation(); removeShortcut(${index})" title="Remove shortcut">⋯</div>
                    <div class="shortcut-icon">
                        ${faviconUrl ? `<img src="${faviconUrl}" alt="" style="width: 100%; height: 100%; border-radius: 8px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">` : ''}
                        <span style="display: ${faviconUrl ? 'none' : 'block'};">${shortcut.title.charAt(0).toUpperCase()}</span>
                    </div>
                    <div class="shortcut-title">${shortcut.title}</div>
                `;
                
                grid.appendChild(shortcutElement);
            });
            
            // Add "Add New" button if less than 9 shortcuts
            if (shortcuts.length < 9) {                const addButton = document.createElement('div');
                addButton.className = 'shortcut-item add-new';
                addButton.onclick = addNewShortcut;
                addButton.innerHTML = `
                    <div class="shortcut-icon">
                        <span class="add-icon">+</span>
                    </div>
                    <div class="shortcut-title">${getLocalizedText('addSite')}</div>
                `;
                grid.appendChild(addButton);
            }
        }

        // Dialog functions
        function showPromptDialog(message, defaultValue, onResult) {
            if (window.DialogHandler && window.DialogHandler.postMessage) {
                const dialogId = Date.now().toString();
                window.pendingDialogs = window.pendingDialogs || {};
                window.pendingDialogs[dialogId] = { onResult };
                
                window.DialogHandler.postMessage(JSON.stringify({
                    type: 'prompt',
                    id: dialogId,
                    message: message,
                    defaultValue: defaultValue || ''
                }));            } else {
                const result = prompt(message, defaultValue);
                onResult && onResult(result);
            }
        }

        function showConfirmDialog(message, onConfirm, onCancel) {
            if (window.DialogHandler && window.DialogHandler.postMessage) {
                const dialogId = Date.now().toString();
                window.pendingDialogs = window.pendingDialogs || {};
                window.pendingDialogs[dialogId] = { onConfirm, onCancel };
                
                window.DialogHandler.postMessage(JSON.stringify({
                    type: 'confirm',
                    id: dialogId,
                    message: message
                }));
            } else {
                if (confirm(message)) {
                    onConfirm && onConfirm();
                } else {
                    onCancel && onCancel();
                }
            }
        }

        // Add new shortcut
        function addNewShortcut() {
            showPromptDialog(getLocalizedText('enterWebsiteUrl'), '', (url) => {
                if (url && url.trim()) {
                    const cleanUrl = url.trim();
                    const defaultTitle = cleanUrl.replace(/^https?:\/\//, '').replace(/^www\./, '');
                      showPromptDialog(getLocalizedText('enterShortcutTitle'), defaultTitle, (title) => {
                        if (title && title.trim()) {
                            const newShortcut = {
                                title: title.trim(),
                                url: cleanUrl
                            };
                            
                            shortcuts.push(newShortcut);
                            localStorage.setItem('solarShortcuts', JSON.stringify(shortcuts));
                            renderShortcuts();
                        }
                    });
                }
            });
        }

        // Remove shortcut
        function removeShortcut(index) {
            const shortcut = shortcuts[index];
            const confirmMessage = getLocalizedText('removeShortcutConfirm').replace('{title}', shortcut.title);
            showConfirmDialog(confirmMessage, () => {
                shortcuts.splice(index, 1);
                localStorage.setItem('solarShortcuts', JSON.stringify(shortcuts));
                renderShortcuts();
            });
        }

        // Theme functions
        function applyTheme(themeData) {
            console.log('🎨 Applying theme:', themeData);
            
            let theme = themeData;
            if (typeof themeData === 'string') {
                try {
                    theme = JSON.parse(themeData);
                } catch (e) {
                    console.error('Failed to parse theme data:', e);
                    return;
                }
            }
            
            // Update current theme
            if (theme.type === 'fullTheme') {
                currentTheme = theme;
            } else if (theme.type === 'theme') {
                currentTheme.isDark = theme.theme === 'dark';
                currentTheme.themeName = theme.theme;
            }
            
            // Apply theme classes
            const body = document.body;
            body.classList.remove('theme-light', 'theme-dark');
            body.classList.add(`theme-${currentTheme.isDark ? 'dark' : 'light'}`);
            
            // Remove existing dynamic theme style
            const existingStyle = document.getElementById('dynamic-theme');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            // Create new dynamic CSS
            const themeStyle = document.createElement('style');
            themeStyle.id = 'dynamic-theme';
            
            themeStyle.textContent = `
                :root {
                    --bg-primary: ${currentTheme.colors.backgroundColor} !important;
                    --bg-surface: ${currentTheme.colors.surfaceColor} !important;
                    --text-primary: ${currentTheme.colors.textColor} !important;
                    --text-secondary: ${currentTheme.colors.textSecondaryColor} !important;
                    --color-primary: ${currentTheme.colors.primaryColor} !important;
                    --color-accent: ${currentTheme.colors.accentColor} !important;
                    --color-error: ${currentTheme.colors.errorColor} !important;
                    --color-success: ${currentTheme.colors.successColor} !important;
                    --color-warning: ${currentTheme.colors.warningColor} !important;
                    --color-secondary: ${currentTheme.colors.secondaryColor} !important;
                }
                
                body {
                    background: ${currentTheme.colors.backgroundColor} !important;
                    color: ${currentTheme.colors.textColor} !important;
                }
            `;
            
            document.head.appendChild(themeStyle);
            console.log('✅ Theme applied successfully');
        }

        // Request functions
        function requestTheme() {
            if (window.ThemeHandler && window.ThemeHandler.postMessage) {
                try {
                    window.ThemeHandler.postMessage('getTheme');
                    console.log('✅ Theme request sent to Flutter');
                } catch (e) {
                    console.error('❌ Error requesting theme:', e);
                }
            } else {
                console.log('⚠️ ThemeHandler not available');
            }
        }

        function requestSearchEngine() {
            if (window.SearchEngineHandler && window.SearchEngineHandler.postMessage) {
                try {
                    window.SearchEngineHandler.postMessage('getSearchEngine');
                    console.log('✅ Search engine request sent to Flutter');
                } catch (e) {
                    console.error('❌ Error requesting search engine:', e);
                }
            } else {
                console.log('⚠️ SearchEngineHandler not available');
            }
        }

        function detectLanguage() {
            if (window.LanguageHandler && window.LanguageHandler.postMessage) {
                try {
                    window.LanguageHandler.postMessage('getLanguage');
                    console.log('✅ Language request sent to Flutter');
                } catch (e) {
                    console.error('❌ Error requesting language:', e);
                    currentLanguage = 'en';
                }
            } else {
                console.log('⚠️ LanguageHandler not available, defaulting to English');
                currentLanguage = 'en';
            }
        }

        function refreshForLanguageChange() {
            console.log('🌐 Language changed, refreshing UI...');
            updateLocalizedUI();            // Clear cached news to force re-fetch with new language
            localStorage.removeItem('solarNews');
            localStorage.removeItem('solarNewsTime');
            fetchNews();
        }

        // Listen for Flutter messages - SINGLE LISTENER ONLY!
        window.addEventListener('message', function(event) {
            console.log('📨 Message received from Flutter:', event.data);
            
            if (event.data && typeof event.data === 'object') {
                const data = event.data;
                const type = data.type;

                switch (type) {
                    case 'theme':
                    case 'fullTheme':
                        console.log('🎨 Applying theme from message');
                        applyTheme(data);
                        break;

                    case 'searchEngine':
                        console.log('🔍 Updating search engine:', data.engine);
                        currentSearchEngine = data.engine || 'Google';
                        updateSearchEngineLogo();
                        break;

                    case 'language':
                        console.log('🌐 Updating language:', data.language);
                        const newLanguage = data.language || 'en';
                        if (newLanguage !== currentLanguage) {
                            currentLanguage = newLanguage;
                            refreshForLanguageChange();
                        }
                        break;

                    case 'dialogResponse':
                        console.log('🗣️ Dialog response received:', data);
                        const dialogId = data.id;
                        const pendingDialog = window.pendingDialogs && window.pendingDialogs[dialogId];

                        if (pendingDialog) {
                            if (data.result !== undefined && pendingDialog.onResult) {
                                // Handle prompt response
                                pendingDialog.onResult(data.result);
                            } else if (data.confirmed !== undefined) {
                                // Handle confirm response
                                if (data.confirmed && pendingDialog.onConfirm) {
                                    pendingDialog.onConfirm();
                                } else if (!data.confirmed && pendingDialog.onCancel) {
                                    pendingDialog.onCancel();
                                }
                            }
                            // Clean up
                            delete window.pendingDialogs[dialogId];
                        }
                        break;

                    case 'newsUpdate':
                        console.log('📰 News update received from message');
                        renderNews(data.articles);
                        isNewsFetching = false;
                        break;

                    default:
                        console.log('⚠️ Unknown message type:', type);
                        break;
                }
            }        });

        // Initialize the homepage properly - NO MORE FAKE NEWS!
        setTimeout(() => {
            console.log('🚀 Initializing Solar Browser homepage - REAL NEWS ONLY!');
            
            // FORCE CLEAR ALL CACHED NEWS - NO MORE OLD FAKE NEWS!
            localStorage.removeItem('solarNews');
            localStorage.removeItem('solarNewsTime');
            console.log('🗑️ CLEARED ALL CACHED NEWS - FORCING FRESH FETCH');
            
            detectLanguage();
            requestTheme();
            requestSearchEngine();
            updateLocalizedUI();
            renderShortcuts();
            fetchNews(); // Load REAL news from Firebase API
            console.log('✅ Homepage initialized with REAL news from Firebase API');
        }, 100);
          console.log('✅ Solar Browser main.html fully loaded - NO MORE FAKE NEWS!');
        console.log('🚀 SCRIPT END - JavaScript completed successfully');
    </script>
</body>
</html>
