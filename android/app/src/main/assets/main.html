<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        :root {
            /* Dynamic theme variables - will be set by applyTheme() */
            --bg-primary: #ffffff;
            --bg-surface: #f5f5f5;
            --text-primary: #000000;
            --text-secondary: #757575;
            --color-primary: #2196f3;
            --color-accent: #1976d2;
            --color-error: #f44336;
            --color-success: #4caf50;
            --color-warning: #ff9800;
            --color-secondary: #e0e0e0;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
        }        .logo {
            width: 80px; /* Increased from 64px */
            height: 80px; /* Increased from 64px */
            margin-bottom: 8px; /* Reduced for logo+label */
            border-radius: 16px;
            object-fit: cover;
            transition: all 0.3s ease;
            background: none !important;
            box-shadow: 
                0 0 20px rgba(33, 150, 243, 0.4),
                0 0 40px rgba(33, 150, 243, 0.2),
                0 0 60px rgba(33, 150, 243, 0.1);
        }

        .logo:hover {
            transform: scale(1.05);
            box-shadow: 
                0 0 30px rgba(33, 150, 243, 0.6),
                0 0 50px rgba(33, 150, 243, 0.4),
                0 0 80px rgba(33, 150, 243, 0.2);
        }

        .solar-label {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 24px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .search-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .search-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-engine-logo {
            position: absolute;
            left: 12px;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
        }

        .search-engine-logo img {
            width: 20px;
            height: 20px;
            object-fit: contain;
            border-radius: 3px;
        }

        .search-box {
            width: 100%;
            padding: 16px 16px 16px 44px; /* Left padding for icon */
            border: 2px solid var(--color-secondary);
            border-radius: 28px;
            font-size: 16px;
            background: var(--bg-surface);
            color: var(--text-primary);
            outline: none;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            border-color: var(--color-primary);
            background: var(--bg-primary);
            box-shadow: 0 4px 20px rgba(33, 150, 243, 0.1);
            transform: translateY(-2px);
        }

        .search-box::placeholder {
            color: var(--text-secondary);
        }

        .shortcuts-container {
            width: 100%;
        }

        .news-section {
            width: 100%;
            margin-top: 20px;
        }

        .news-header {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
        }

        .news-item {
            display: block;
            text-decoration: none;
            background: var(--bg-surface);
            border: 1px solid var(--color-secondary);
            border-radius: 16px;
            padding: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            overflow: hidden;
        }

        .news-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            border-color: var(--color-primary);
        }

        .news-item-image {
            width: 100%;
            height: 120px;
            border-radius: 12px;
            margin-bottom: 12px;
            object-fit: cover;
        }

        .news-item-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }        .news-item-summary {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            max-height: 63px; /* Approximately 3 lines */
            transition: all 0.5s ease;
        }

        .news-item-summary.expanded {
            display: block;
            -webkit-line-clamp: unset;
            line-clamp: unset;
            max-height: 2000px; /* Large enough to show full content */
            overflow: visible;
            transition: all 0.8s ease;
        }        .news-item-expand {
            font-size: 13px;
            font-weight: 500;
            color: var(--color-primary);
            cursor: pointer;
            margin: 12px 0 8px 0;
            text-align: center;
            padding: 8px 16px;
            border: 2px solid var(--color-primary);
            border-radius: 20px;
            background: var(--bg-primary);
            transition: all 0.3s ease;
            display: inline-block;
            min-width: 120px;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
        }

        .news-item-expand:hover {
            background: var(--color-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(33, 150, 243, 0.2);
        }

        .news-item-source {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .news-loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
            font-size: 16px;
        }

        .news-error {
            text-align: center;
            padding: 40px;
            color: var(--color-error);
            font-size: 16px;
        }

        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 16px;
            width: 100%;
        }

        .shortcut-item {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: var(--bg-surface);
            border: 1px solid var(--color-secondary);
            border-radius: 16px;
            text-decoration: none;
            color: var(--text-primary);
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 120px;
        }

        .shortcut-menu {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: var(--color-error);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            cursor: pointer;
            transition: opacity 0.2s ease;
            font-size: 12px;
            z-index: 10;
        }

        .shortcut-item:hover .shortcut-menu {
            opacity: 1;
        }        .shortcut-menu:hover {
            background: var(--color-error);
            color: white;
        }

        .shortcut-remove {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 28px;
            height: 28px;
            background: var(--color-error);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            z-index: 10;
            border: 2px solid var(--bg-primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            animation: editModeAppear 0.3s ease;
        }

        .shortcut-remove:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        @keyframes editModeAppear {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }        .edit-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 12px;
            width: 40px;
            height: 40px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .edit-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
            background: var(--color-accent);
        }

        .edit-btn.active {
            background: var(--color-success);
            box-shadow: 0 4px 16px rgba(76, 175, 80, 0.4);
        }

        .shortcut-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            background: var(--color-primary);
            color: white;
        }

        .shortcut-item.add-new {
            border: 2px dashed var(--color-primary);
            background: transparent;
            color: var(--color-primary);
        }

        .shortcut-item.add-new:hover {
            background: var(--color-primary);
            color: white;
        }

        .shortcut-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--color-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 12px;
        }

        .shortcut-title {
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            line-height: 1.3;
            opacity: 0.9;
        }

        .add-icon {
            font-size: 32px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .logo {
                width: 64px;
                height: 64px;
            }

            .solar-label {
                font-size: 16px;
            }

            .search-container {
                gap: 8px;
            }

            .search-engine-logo {
                width: 16px;
                height: 16px;
                left: 10px;
            }

            .search-engine-logo img {
                width: 16px;
                height: 16px;
            }

            .search-box {
                padding: 14px 14px 14px 36px;
                font-size: 16px;
            }

            .news-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .shortcuts-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }

            .shortcut-item {
                padding: 16px 12px;
                min-height: 100px;
            }

            .shortcut-icon {
                width: 40px;
                height: 40px;
                font-size: 20px;
                margin-bottom: 8px;
            }

            .shortcut-title {
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .container {
                gap: 30px;
            }

            .shortcuts-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .shortcut-item {
                padding: 12px 8px;
                min-height: 90px;
            }

            .shortcut-icon {
                width: 36px;
                height: 36px;
                font-size: 18px;
                margin-bottom: 6px;
            }

            .shortcut-title {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>    <!-- Edit mode button -->
      <div class="container">        <img src="logo.png" alt="Solar Browser" class="logo" onerror="console.log('Logo failed to load, trying alternative path'); this.src='flutter_assets/assets/logo.png';" style="width: 120px; height: 120px; border-radius: 16px; background: none !important; filter: drop-shadow(0 0 25px rgba(33, 150, 243, 0.6)) drop-shadow(0 0 50px rgba(33, 150, 243, 0.3)); transition: filter 0.3s ease;" onmouseover="this.style.filter='drop-shadow(0 0 40px rgba(33, 150, 243, 0.8)) drop-shadow(0 0 80px rgba(33, 150, 243, 0.4))'" onmouseout="this.style.filter='drop-shadow(0 0 25px rgba(33, 150, 243, 0.6)) drop-shadow(0 0 50px rgba(33, 150, 243, 0.3))'">

        <div class="search-container">
            <div class="search-input-container">
                <div class="search-engine-logo" id="searchEngineLogo">
                    <img src="https://www.google.com/favicon.ico" alt="Google" id="searchEngineIcon">
                </div>
                <input type="text" class="search-box" placeholder="Search or enter address" autocomplete="off">
            </div>
        </div>

        <div class="shortcuts-container">
            <div class="shortcuts-grid" id="shortcutsGrid">
                <!-- Dynamic shortcuts will be added here -->
            </div>
        </div>

        <div class="news-section" id="newsSection">
            <div class="news-header">
                <span id="newsTitle">Vertex News</span>
            </div>
            <div id="newsContent">
                <div class="news-loading" id="newsLoading">Loading news...</div>
            </div>
        </div>
    </div>
    <script>
        console.log('üöÄ SCRIPT START - Testing if JavaScript executes');
        console.log('üöÄ Solar Browser main.html loaded - CLEAN VERSION WITH REAL NEWS');
        
        // Shortcuts data
        let shortcuts = JSON.parse(localStorage.getItem('solarShortcuts') || '[]');
        
        // Search engines configuration
        const searchEngines = {
            'Google': {
                name: 'Google',
                icon: 'https://www.google.com/favicon.ico',
                url: 'https://www.google.com/search?q={query}'
            },
            'Bing': {
                name: 'Bing',
                icon: 'https://www.bing.com/favicon.ico',
                url: 'https://www.bing.com/search?q={query}'
            },
            'DuckDuckGo': {
                name: 'DuckDuckGo',
                icon: 'https://duckduckgo.com/favicon.ico',
                url: 'https://duckduckgo.com/?q={query}'
            },
            'Brave': {
                name: 'Brave',
                icon: 'https://brave.com/favicon.ico',
                url: 'https://search.brave.com/search?q={query}'
            },
            'Yahoo': {
                name: 'Yahoo',
                icon: 'https://www.yahoo.com/favicon.ico',
                url: 'https://search.yahoo.com/search?p={query}'
            },
            'Yandex': {
                name: 'Yandex',
                icon: 'https://yandex.com/favicon.ico',
                url: 'https://yandex.com/search/?text={query}'
            },
            'Solar Search': {
                name: 'Solar Search',
                icon: 'https://raw.githubusercontent.com/solarbrowser/mobile/refs/heads/main/assets/icon.png',
                url: 'https://search.browser.solar/search?q={query}'
            }
        };        // Current search engine (will be updated from Flutter)
        let currentSearchEngine = 'Google';
        
        // News configuration - REAL API ONLY!
        const newsConfig = {
            url: 'https://firebasestorage.googleapis.com/v0/b/vertex-ai-1618.firebasestorage.app/o/public-cache%2Fnews.json?alt=media&token=c1553d29-fa55-4520-9bec-e1d3416be62a',
            fallbackUrl: 'https://firebasestorage.googleapis.com/v0/b/vertex-ai-1618.firebasestorage.app/o/public-cache%2Fnews.json?alt=media&token=c1553d29-fa55-4520-9bec-e1d3416be62a',            maxItems: 6,
            refreshInterval: 30 * 60 * 1000 // 30 minutes
        };
        
        // Localization data
        const localizations = {
            'ar': {
                news: 'ÿ£ÿÆÿ®ÿßÿ± ŸÅŸäÿ±ÿ™ŸÉÿ≥',
                loading: 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿÆÿ®ÿßÿ±...',
                error: 'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿÆÿ®ÿßÿ±',
                searchPlaceholder: 'ÿßÿ®ÿ≠ÿ´ ÿ£Ÿà ÿ£ÿØÿÆŸÑ ÿßŸÑÿπŸÜŸàÿßŸÜ',
                addSite: 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸàŸÇÿπ',
                readMore: 'ÿßŸÇÿ±ÿ£ ÿßŸÑŸÖÿ≤ŸäÿØ',
                showLess: 'ÿπÿ±ÿ∂ ÿ£ŸÇŸÑ',
                enterWebsiteUrl: 'ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖŸàŸÇÿπ (ŸÖÿ´ÿßŸÑ: google.com):',
                enterShortcutTitle: 'ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑÿßÿÆÿ™ÿµÿßÿ±:',
                removeShortcutConfirm: 'ÿ•ÿ≤ÿßŸÑÿ© "{title}" ŸÖŸÜ ÿßŸÑÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ÿü',
                downloadImage: 'ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©',
                copyImage: 'ŸÜÿ≥ÿÆ ÿßŸÑÿµŸàÿ±ÿ©',
                openImageNewTab: 'ŸÅÿ™ÿ≠ ÿßŸÑÿµŸàÿ±ÿ© ŸÅŸä ÿπŸÑÿßŸÖÿ© ÿ™ÿ®ŸàŸäÿ® ÿ¨ÿØŸäÿØÿ©',
                copyText: 'ŸÜÿ≥ÿÆ',
                pasteText: 'ŸÑÿµŸÇ',
                cutText: 'ŸÇÿµ'
            },
            'de': {
                news: 'Vertex Nachrichten',
                loading: 'Nachrichten laden...',
                error: 'Nachrichten konnten nicht geladen werden',
                searchPlaceholder: 'Suchen oder Adresse eingeben',
                addSite: 'Seite hinzuf√ºgen',
                readMore: 'Mehr lesen',
                showLess: 'Weniger anzeigen',
                enterWebsiteUrl: 'Website-URL eingeben (z.B. google.com):',
                enterShortcutTitle: 'Verkn√ºpfungstitel eingeben:',
                removeShortcutConfirm: '"{title}" aus Verkn√ºpfungen entfernen?',
                downloadImage: 'Bild herunterladen',
                copyImage: 'Bild kopieren',
                openImageNewTab: 'Bild in neuem Tab √∂ffnen',
                copyText: 'Kopieren',
                pasteText: 'Einf√ºgen',
                cutText: 'Ausschneiden'
            },
            'en': {
                news: 'Vertex News',
                loading: 'Loading news...',
                error: 'Failed to load news',
                searchPlaceholder: 'Search or enter address',
                addSite: 'Add Site',
                readMore: 'Read More',
                showLess: 'Show Less',
                enterWebsiteUrl: 'Enter website URL (e.g., google.com):',
                enterShortcutTitle: 'Enter shortcut title:',
                removeShortcutConfirm: 'Remove "{title}" from shortcuts?',
                downloadImage: 'Download Image',
                copyImage: 'Copy Image',
                openImageNewTab: 'Open Image in New Tab',
                copyText: 'Copy',
                pasteText: 'Paste',
                cutText: 'Cut'
            },
            'es': {
                news: 'Noticias Vertex',
                loading: 'Cargando noticias...',
                error: 'Error al cargar noticias',
                searchPlaceholder: 'Buscar o ingresar direcci√≥n',
                addSite: 'Agregar Sitio',
                readMore: 'Leer M√°s',
                showLess: 'Mostrar Menos',
                enterWebsiteUrl: 'Ingrese URL del sitio web (ej: google.com):',
                enterShortcutTitle: 'Ingrese t√≠tulo del acceso directo:',
                removeShortcutConfirm: '¬øEliminar "{title}" de los accesos directos?',
                downloadImage: 'Descargar Imagen',
                copyImage: 'Copiar Imagen',
                openImageNewTab: 'Abrir Imagen en Nueva Pesta√±a',
                copyText: 'Copiar',
                pasteText: 'Pegar',
                cutText: 'Cortar'
            },
            'fr': {
                news: 'Actualit√©s Vertex',
                loading: 'Chargement des actualit√©s...',
                error: '√âchec du chargement des actualit√©s',
                searchPlaceholder: 'Rechercher ou entrer une adresse',
                addSite: 'Ajouter un Site',
                readMore: 'Lire Plus',
                showLess: 'Afficher Moins',
                enterWebsiteUrl: 'Entrez l\'URL du site web (ex: google.com):',
                enterShortcutTitle: 'Entrez le titre du raccourci:',
                removeShortcutConfirm: 'Supprimer "{title}" des raccourcis?',
                downloadImage: 'T√©l√©charger l\'Image',
                copyImage: 'Copier l\'Image',
                openImageNewTab: 'Ouvrir l\'Image dans un Nouvel Onglet',
                copyText: 'Copier',
                pasteText: 'Coller',
                cutText: 'Couper'
            },
            'hi': {
                news: '‡§µ‡§∞‡•ç‡§ü‡•á‡§ï‡•ç‡§∏ ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞',
                loading: '‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...',
                error: '‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
                searchPlaceholder: '‡§ñ‡•ã‡§ú‡•á‡§Ç ‡§Ø‡§æ ‡§™‡§§‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                addSite: '‡§∏‡§æ‡§á‡§ü ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
                readMore: '‡§î‡§∞ ‡§™‡§¢‡§º‡•á‡§Ç',
                showLess: '‡§ï‡§Æ ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç',
                enterWebsiteUrl: '‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü URL ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: google.com):',
                enterShortcutTitle: '‡§∂‡•â‡§∞‡•ç‡§ü‡§ï‡§ü ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:',
                removeShortcutConfirm: '‡§∂‡•â‡§∞‡•ç‡§ü‡§ï‡§ü ‡§∏‡•á "{title}" ‡§π‡§ü‡§æ‡§è‡§Ç?',
                downloadImage: '‡§ö‡§ø‡§§‡•ç‡§∞ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç',
                copyImage: '‡§ö‡§ø‡§§‡•ç‡§∞ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç',
                openImageNewTab: '‡§®‡§è ‡§ü‡•à‡§¨ ‡§Æ‡•á‡§Ç ‡§ö‡§ø‡§§‡•ç‡§∞ ‡§ñ‡•ã‡§≤‡•á‡§Ç',
                copyText: '‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç',
                pasteText: '‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç',
                cutText: '‡§ï‡§ü ‡§ï‡§∞‡•á‡§Ç'
            },
            'it': {
                news: 'Notizie Vertex',
                loading: 'Caricamento notizie...',
                error: 'Caricamento notizie fallito',
                searchPlaceholder: 'Cerca o inserisci indirizzo',
                addSite: 'Aggiungi Sito',
                readMore: 'Leggi di Pi√π',
                showLess: 'Mostra Meno',
                enterWebsiteUrl: 'Inserisci URL del sito web (es: google.com):',
                enterShortcutTitle: 'Inserisci titolo collegamento:',
                removeShortcutConfirm: 'Rimuovere "{title}" dai collegamenti?',
                downloadImage: 'Scarica Immagine',
                copyImage: 'Copia Immagine',
                openImageNewTab: 'Apri Immagine in Nuova Scheda',
                copyText: 'Copia',
                pasteText: 'Incolla',
                cutText: 'Taglia'
            },
            'ja': {
                news: 'Vertex„Éã„É•„Éº„Çπ',
                loading: '„Éã„É•„Éº„Çπ„ÇíË™≠„ÅøËæº„Åø‰∏≠...',
                error: '„Éã„É•„Éº„Çπ„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü',
                searchPlaceholder: 'Ê§úÁ¥¢„Åæ„Åü„ÅØ„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ',
                addSite: '„Çµ„Ç§„Éà„ÇíËøΩÂä†',
                readMore: 'Á∂ö„Åç„ÇíË™≠„ÇÄ',
                showLess: 'Â∞ë„Å™„ÅèË°®Á§∫',
                enterWebsiteUrl: '„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„ÅÆURL„ÇíÂÖ•Âäõ (‰æã: google.com):',
                enterShortcutTitle: '„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„ÅÆ„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ:',
                removeShortcutConfirm: '„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Åã„Çâ"{title}"„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü',
                downloadImage: 'ÁîªÂÉè„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ',
                copyImage: 'ÁîªÂÉè„Çí„Ç≥„Éî„Éº',
                openImageNewTab: 'Êñ∞„Åó„ÅÑ„Çø„Éñ„ÅßÁîªÂÉè„ÇíÈñã„Åè',
                copyText: '„Ç≥„Éî„Éº',
                pasteText: 'Ë≤º„Çä‰ªò„Åë',
                cutText: 'Âàá„ÇäÂèñ„Çä'
            },
            'ko': {
                news: 'Vertex Îâ¥Ïä§',
                loading: 'Îâ¥Ïä§ Î°úÎî© Ï§ë...',
                error: 'Îâ¥Ïä§ Î°úÎìú Ïã§Ìå®',
                searchPlaceholder: 'Í≤ÄÏÉâÌïòÍ±∞ÎÇò Ï£ºÏÜå ÏûÖÎ†•',
                addSite: 'ÏÇ¨Ïù¥Ìä∏ Ï∂îÍ∞Ä',
                readMore: 'Îçî ÏùΩÍ∏∞',
                showLess: 'Ï†ÅÍ≤å Î≥¥Í∏∞',
                enterWebsiteUrl: 'ÏõπÏÇ¨Ïù¥Ìä∏ URL ÏûÖÎ†• (Ïòà: google.com):',
                enterShortcutTitle: 'Î∞îÎ°úÍ∞ÄÍ∏∞ Ï†úÎ™© ÏûÖÎ†•:',
                removeShortcutConfirm: 'Î∞îÎ°úÍ∞ÄÍ∏∞ÏóêÏÑú "{title}"ÏùÑ(Î•º) Ï†úÍ±∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                downloadImage: 'Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú',
                copyImage: 'Ïù¥ÎØ∏ÏßÄ Î≥µÏÇ¨',
                openImageNewTab: 'ÏÉà ÌÉ≠ÏóêÏÑú Ïù¥ÎØ∏ÏßÄ Ïó¥Í∏∞',
                copyText: 'Î≥µÏÇ¨',
                pasteText: 'Î∂ôÏó¨ÎÑ£Í∏∞',
                cutText: 'ÏûòÎùºÎÇ¥Í∏∞'
            },
            'pt': {
                news: 'Not√≠cias Vertex',
                loading: 'Carregando not√≠cias...',
                error: 'Falha ao carregar not√≠cias',
                searchPlaceholder: 'Pesquisar ou inserir endere√ßo',
                addSite: 'Adicionar Site',
                readMore: 'Ler Mais',
                showLess: 'Mostrar Menos',
                enterWebsiteUrl: 'Digite a URL do site (ex: google.com):',
                enterShortcutTitle: 'Digite o t√≠tulo do atalho:',
                removeShortcutConfirm: 'Remover "{title}" dos atalhos?',
                downloadImage: 'Baixar Imagem',
                copyImage: 'Copiar Imagem',
                openImageNewTab: 'Abrir Imagem em Nova Aba',
                copyText: 'Copiar',
                pasteText: 'Colar',
                cutText: 'Cortar'
            },
            'ru': {
                news: '–ù–æ–≤–æ—Å—Ç–∏ Vertex',
                loading: '–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...',
                error: '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏',
                searchPlaceholder: '–ü–æ–∏—Å–∫ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å',
                addSite: '–î–æ–±–∞–≤–∏—Ç—å –°–∞–π—Ç',
                readMore: '–ß–∏—Ç–∞—Ç—å –î–∞–ª–µ–µ',
                showLess: '–ü–æ–∫–∞–∑–∞—Ç—å –ú–µ–Ω—å—à–µ',
                enterWebsiteUrl: '–í–≤–µ–¥–∏—Ç–µ URL —Å–∞–π—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: google.com):',
                enterShortcutTitle: '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —è—Ä–ª—ã–∫–∞:',
                removeShortcutConfirm: '–£–¥–∞–ª–∏—Ç—å "{title}" –∏–∑ —è—Ä–ª—ã–∫–æ–≤?',
                downloadImage: '–°–∫–∞—á–∞—Ç—å –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
                copyImage: '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
                openImageNewTab: '–û—Ç–∫—Ä—ã—Ç—å –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ù–æ–≤–æ–π –í–∫–ª–∞–¥–∫–µ',
                copyText: '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å',
                pasteText: '–í—Å—Ç–∞–≤–∏—Ç—å',
                cutText: '–í—ã—Ä–µ–∑–∞—Ç—å'
            },
            'tr': {
                news: 'Vertex Haberleri',
                loading: 'Haberler y√ºkleniyor...',
                error: 'Haberler y√ºklenemedi',
                searchPlaceholder: 'Ara veya adres gir',
                addSite: 'Site Ekle',
                readMore: 'Devamƒ±nƒ± Oku',
                showLess: 'Daha Az G√∂ster',
                enterWebsiteUrl: 'Website URL\'si girin (√∂rn: google.com):',
                enterShortcutTitle: 'Kƒ±sayol ba≈ülƒ±ƒüƒ± girin:',
                removeShortcutConfirm: 'Kƒ±sayollardan "{title}" kaldƒ±rƒ±lsƒ±n mƒ±?'
            },
            'zh': {
                news: 'Vertex Êñ∞Èóª',
                loading: 'Ê≠£Âú®Âä†ËΩΩÊñ∞Èóª...',
                error: 'Âä†ËΩΩÊñ∞ÈóªÂ§±Ë¥•',
                searchPlaceholder: 'ÊêúÁ¥¢ÊàñËæìÂÖ•Âú∞ÂùÄ',
                addSite: 'Ê∑ªÂä†ÁΩëÁ´ô',
                readMore: 'ÈòÖËØªÊõ¥Â§ö',
                showLess: 'ÊòæÁ§∫ËæÉÂ∞ë',
                enterWebsiteUrl: 'ËæìÂÖ•ÁΩëÁ´ôURL (‰æãÂ¶Ç: google.com):',
                enterShortcutTitle: 'ËæìÂÖ•Âø´Êç∑ÊñπÂºèÊ†áÈ¢ò:',
                removeShortcutConfirm: '‰ªéÂø´Êç∑ÊñπÂºè‰∏≠Âà†Èô§"{title}"Ôºü'
            }
        };

        // Current language and theme
        let currentLanguage = 'en';
        let currentTheme = {
            themeName: 'light',
            isDark: false,
            colors: {
                backgroundColor: '#ffffff',
                surfaceColor: '#f5f5f5',
                textColor: '#000000',
                textSecondaryColor: '#757575',
                primaryColor: '#2196f3',
                accentColor: '#1976d2',
                errorColor: '#f44336',
                successColor: '#4caf50',
                warningColor: '#ff9800',
                secondaryColor: '#e0e0e0'
            }
        };

        // Helper functions
        function getLocalizedText(key) {
            return localizations[currentLanguage]?.[key] || localizations['en'][key] || key;
        }

        function updateSearchEngineLogo() {
            const engine = searchEngines[currentSearchEngine] || searchEngines['Google'];
            const iconImg = document.getElementById('searchEngineIcon');
            if (iconImg) {
                iconImg.src = engine.icon;
                iconImg.alt = engine.name;                iconImg.onerror = function() {
                    console.log('Failed to load search engine icon, using fallback');
                    this.src = 'https://www.google.com/favicon.ico';
                };
            }
            console.log('üîç Updated search engine logo:', currentSearchEngine, engine.icon);
        }

        function updateLocalizedUI() {
            // Update news section
            const newsTitle = document.getElementById('newsTitle');
            if (newsTitle) {
                newsTitle.textContent = getLocalizedText('news');
            }

            // Update search placeholder
            const searchBox = document.querySelector('.search-box');
            if (searchBox) {
                searchBox.placeholder = getLocalizedText('searchPlaceholder');
            }

            // Update "Add Site" text
            const addSiteText = document.getElementById('addSiteText');
            if (addSiteText) {
                addSiteText.textContent = getLocalizedText('addSite');
            }            // Update any existing "Add Site" elements created dynamically
            const addSiteElements = document.querySelectorAll('.shortcut-item.add-new .shortcut-title');
            addSiteElements.forEach(element => {
                element.textContent = getLocalizedText('addSite');
            });

            console.log('üåê Updated localized UI for language:', currentLanguage);
        }

        // News handling - RECEIVES DATA FROM FLUTTER!
        let isNewsFetching = false;

        // This function is called by Flutter with news data
        function renderNews(newsData) {
            console.log('üì∞ renderNews called by Flutter with:', newsData);
            console.log('üì∞ newsContent element ID:', document.getElementById('newsContent') ? 'FOUND' : 'NOT FOUND');
            
            try {
                const newsContent = document.getElementById('newsContent');
                if (!newsContent) {
                    console.error('üì∞ News content element not found');
                    return;
                }

                // Update the news title to remove "Latest News" text
                const newsTitle = document.getElementById('newsTitle');
                if (newsTitle) {
                    // Remove the news title completely
                    newsTitle.style.display = 'none';
                }

                // Handle different data formats
                let articles = [];
                if (Array.isArray(newsData)) {
                    articles = newsData;
                    console.log('üì∞ newsData is array, length:', articles.length);
                } else if (newsData.articles) {
                    articles = newsData.articles;
                    console.log('üì∞ newsData has articles property, length:', articles.length);
                } else {
                    console.error('üì∞ Invalid news data format:', newsData);
                    renderNewsError('Invalid news data format');
                    return;
                }

                if (!articles || articles.length === 0) {
                    console.log('üì∞ No articles to display');
                    // Don't show error message, just hide the section
                    newsContent.innerHTML = '';
                    const newsSection = document.getElementById('newsSection');
                    if (newsSection) {
                        newsSection.style.display = 'none';
                    }
                    return;
                }

                // Limit to maxItems
                articles = articles.slice(0, newsConfig.maxItems);
                console.log('üì∞ Rendering', articles.length, 'articles');

                const newsGrid = document.createElement('div');
                newsGrid.className = 'news-grid';

                let renderedCount = 0;
                articles.forEach((article, index) => {
                    try {
                        const newsItem = createNewsItem(article);
                        if (newsItem) {
                            newsGrid.appendChild(newsItem);
                            renderedCount++;
                        }
                    } catch (error) {
                        console.error('üì∞ Error creating news item:', error, article);
                    }
                });

                newsContent.innerHTML = '';
                newsContent.appendChild(newsGrid);
                
                console.log('‚úÖ Successfully rendered', renderedCount, 'news items');
                
            } catch (error) {
                console.error('üì∞ Error in renderNews:', error);
                // Don't show error message
                const newsContent = document.getElementById('newsContent');
                if (newsContent) {
                    newsContent.innerHTML = '';
                }
            }
        }

        // This function is called by Flutter when there's an error
        function renderNewsError(message = null) {
            console.log('üì∞ renderNewsError called with message:', message);
            
            const newsContent = document.getElementById('newsContent');
            if (!newsContent) return;

            const errorText = message || getLocalizedText('newsError') || 'Unable to load news';
            newsContent.innerHTML = `<div class="news-error">${errorText}</div>`;
        }

        // Show loading state (called internally)
        function showNewsLoading() {
            const newsContent = document.getElementById('newsContent');
            if (!newsContent) return;
            
            // Clear content but don't show loading text
            newsContent.innerHTML = '';
            
            // Hide news title
            const newsTitle = document.getElementById('newsTitle');
            if (newsTitle) {
                newsTitle.style.display = 'none';
            }
        }

        // Request news from Flutter
        function requestNews() {
            console.log('üì∞ Requesting news from Flutter...');
            showNewsLoading();
            
            if (window.NewsHandler && window.NewsHandler.postMessage) {
                console.log('üì∞ ‚úÖ NewsHandler available! Requesting news from Flutter...');
                window.NewsHandler.postMessage('fetchNews');
                console.log('üì∞ üì§ Sent fetchNews message to Flutter NewsHandler');
            } else {
                console.log('üì∞ ‚ùå NewsHandler not available');
                renderNewsError('News service not available');
            }
        }

        async function fetchNewsFromUrl(url, isFallback = false) {
            const now = Date.now();
            const urlWithCacheBuster = `${url}${url.includes('?') ? '&' : '?'}v=${now}&cb=${Math.random()}`;
            
            console.log('üì∞ Fetching from URL:', urlWithCacheBuster);
            
            const response = await fetch(urlWithCacheBuster, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'User-Agent': 'Solar Browser/1.0',
                    'X-Master-Key': '$2a$10$7H.P9/dBKGvCKMM/qJXZKOq.OYT9Vd/sMNJCkB8rPG8KG8HrKKvj.'
                },
                mode: 'cors',
                cache: 'no-store' // Force no cache
            });

            console.log('üì∞ Response status:', response.status, response.statusText);

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const responseText = await response.text();
            console.log('üì∞ Raw response (first 500 chars):', responseText.substring(0, 500));

            let newsData;
            try {
                const parsedResponse = JSON.parse(responseText);
                  if (isFallback) {
                    // JSONPlaceholder format - convert to our format
                    console.log('üì∞ Converting JSONPlaceholder format');
                    const articles = parsedResponse.slice(0, newsConfig.maxItems).map((item, index) => ({
                        id: item.id || `fallback-${index}`,
                        translations: {
                            en: {
                                title: item.title || `News ${index + 1}`,
                                summary: item.body || 'No summary available. This is a sample news article with extended content to demonstrate the expand/collapse functionality. Click "Read More" to see how the news expands to show the full article content.'
                            },
                            tr: {
                                title: `Haber ${index + 1}`,
                                summary: 'Bu bir √∂rnek haber i√ßeriƒüidir. Geni≈ületme ve daraltma i≈ülevselliƒüini g√∂stermek i√ßin uzun i√ßerik √∂rneƒüi. Tam makale i√ßeriƒüini g√∂rmek i√ßin "Devamƒ±nƒ± Oku" d√ºƒümesine tƒ±klayƒ±n.'
                            }
                        },
                        cover: {
                            en: `https://picsum.photos/300/200?random=${item.id || index}`
                        },
                        references: [`https://jsonplaceholder.typicode.com/posts/${item.id || index}`],
                        publishedAt: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString()
                    }));
                    newsData = { articles };
                } else {
                    // Check if response has record property (JSONBin format)
                    if (parsedResponse.record && Array.isArray(parsedResponse.record)) {
                        newsData = { articles: parsedResponse.record };
                    } else if (Array.isArray(parsedResponse)) {
                        newsData = { articles: parsedResponse };
                    } else {
                        newsData = parsedResponse;
                    }
                }
            } catch (parseError) {
                console.error('‚ùå JSON parse error:', parseError);
                console.error('‚ùå Raw response that failed to parse:', responseText);
                throw new Error('Invalid JSON response: ' + parseError.message);
            }

            console.log('üì∞ Parsed news data:', newsData);
            console.log('üì∞ Number of articles:', newsData.articles ? newsData.articles.length : 0);

            // Handle the response format
            let articles = [];
            if (newsData.articles) {
                articles = newsData.articles;
                console.log('üì∞ Found', articles.length, 'articles in response');
            } else {
                console.log('üì∞ No articles array found in response');
            }            // Cache the news
            localStorage.setItem('solarNews', JSON.stringify(articles));
            localStorage.setItem('solarNewsTime', now.toString());
            console.log('üì∞ Cached', articles.length, 'articles with timestamp:', now);
            console.log('‚úÖ News data processed and cached, rendering now...');
            renderNews(articles);
        }

        // ...existing code...

        function createNewsItem(article) {
            console.log('üì∞ createNewsItem called with article:', article);
            
            // Extract article data - simpler format from Flutter
            let title = article.title || 'Untitled';
            let summary = article.summary || '';
            let fullContent = article.content || summary || '';
            let imageUrl = article.image || ''; // Use image field from Flutter
            let publishedAt = article.publishedAt || '';
            
            // Don't process articles without a title
            if (!title) return null;

            // Don't truncate - show full content as per requirements
            // We'll make it expandable/collapsible by default
            
            console.log('üì∞ News item:', title);
            console.log('üì∞ Content length:', fullContent?.length || 0);
            console.log('üì∞ Image URL:', imageUrl || 'None');

            // Create the news item container
            const newsItem = document.createElement('div');
            newsItem.className = 'news-item';
            newsItem.style.cursor = 'default'; // Explicitly no pointer cursor
            
            // Prevent any clicks from navigating
            newsItem.onclick = function(e) {
                // Only allow expand/collapse button clicks
                if (!e.target.classList.contains('news-item-expand')) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            };
            
            // Create unique ID for this news item
            const itemId = 'news-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            newsItem.id = itemId;

            // Always show image if available
            // Always show image if available with better error handling
            const imageHtml = imageUrl 
                ? `<img src="${imageUrl}" alt="${title}" class="news-item-image" onerror="this.onerror=null; this.src=''; this.style.display='none'; console.log('Failed to load image: ${imageUrl}');">`
                : `<div class="news-item-image" style="display: none;"></div>`; // Hide image container if no image

            const timeAgo = publishedAt ? formatTimeAgo(new Date(publishedAt)) : '';
            
            // Clean and escape content for data attributes
            const cleanFullContent = (fullContent || '').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
            
            // Make news items collapsible by default - initially collapsed
            const hasContent = fullContent && fullContent.length > 0;
            const expandButtonHtml = hasContent
                ? `<div class="news-item-expand" onclick="toggleNewsExpansion('${itemId}')">${getLocalizedText('readMore')}</div>` 
                : '';

            console.log('üì∞ Has content?', hasContent);
            console.log('üì∞ Show expand button?', !!expandButtonHtml);

            newsItem.innerHTML = `
                ${imageHtml}
                <div class="news-item-title">${title}</div>
                <div class="news-item-summary" data-full="${cleanFullContent}">${summary}</div>
                ${expandButtonHtml}
                <div class="news-item-source">
                    ${timeAgo ? `<span>${timeAgo}</span>` : ''}
                </div>
            `;

            return newsItem;
        }

        // Function to toggle news expansion
        function toggleNewsExpansion(itemId) {
            const newsItem = document.getElementById(itemId);
            if (!newsItem) return;
            
            const summaryElement = newsItem.querySelector('.news-item-summary');
            const expandButton = newsItem.querySelector('.news-item-expand');
            
            if (!summaryElement || !expandButton) return;
            
            // Get the full content
            const fullContent = summaryElement.getAttribute('data-full')?.replace(/&quot;/g, '"')?.replace(/&#39;/g, "'") || '';
            const isExpanded = summaryElement.classList.contains('expanded');
            
            if (isExpanded) {
                // Collapse
                summaryElement.classList.remove('expanded');
                // Keep the summary as is but collapse it
                expandButton.innerHTML = getLocalizedText('readMore') || 'Read More';
                console.log('üì∞ News collapsed');
            } else {
                // Expand
                summaryElement.classList.add('expanded');
                // Show full content with proper line breaks
                if (fullContent) {
                    summaryElement.innerHTML = fullContent.replace(/\n/g, '<br>');
                }
                expandButton.innerHTML = getLocalizedText('showLess') || 'Show Less';
                console.log('üì∞ News expanded, full content length:', fullContent.length);
                
                // Smooth scroll to ensure the expanded content is visible
                setTimeout(() => {
                    expandButton.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'nearest' 
                    });
                }, 100);
            }
        }

        function formatTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return `${diffInSeconds}s ago`;
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            return `${Math.floor(diffInSeconds / 86400)}d ago`;
        }

        // ...existing code...

        // Search functionality
        document.querySelector('.search-box').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const query = this.value.trim();
                console.log('Search query entered:', query);
                
                if (query) {
                    // Check if it looks like a URL
                    if (query.includes('.') && !query.includes(' ')) {
                        const url = query.startsWith('http') ? query : `https://${query}`;
                        console.log('Navigating to URL:', url);
                        window.location.href = url;
                    } else {
                        // It's a search query
                        console.log('Sending search query to Flutter');
                        if (window.SearchHandler && window.SearchHandler.postMessage) {
                            window.SearchHandler.postMessage(query);
                        } else {
                            // Fallback to Google
                            const fallbackUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                            window.location.href = fallbackUrl;
                        }
                    }
                }
            }
        });

        // Get favicon URL for a website
        function getFaviconUrl(url) {
            try {
                const domain = new URL(url.startsWith('http') ? url : 'https://' + url).hostname;
                return `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;
            } catch (e) {
                return '';
            }
        }

        // Render shortcuts        // Edit mode for shortcuts
        let isEditMode = false;        function toggleEditMode() {
            isEditMode = !isEditMode;
            const editBtn = document.getElementById('editBtn');
            if (editBtn) {
                if (isEditMode) {
                    editBtn.textContent = '‚úì';
                    editBtn.classList.add('active');
                    editBtn.title = 'Done editing';
                } else {
                    editBtn.textContent = '‚úèÔ∏è';
                    editBtn.classList.remove('active');
                    editBtn.title = 'Edit shortcuts';
                }
            }
            renderShortcuts();
        }

        function renderShortcuts() {
            const grid = document.getElementById('shortcutsGrid');
            
            // Clear existing shortcuts except add button
            grid.innerHTML = '';
              // Add existing shortcuts
            shortcuts.forEach((shortcut, index) => {
                const shortcutElement = document.createElement('a');
                shortcutElement.className = 'shortcut-item';
                shortcutElement.href = shortcut.url.startsWith('http') ? shortcut.url : 'https://' + shortcut.url;
                
                // Only add navigation if not in edit mode
                if (!isEditMode) {
                    shortcutElement.onclick = function(e) {
                        e.preventDefault();
                        window.location.href = this.href;
                    };
                } else {
                    // Prevent navigation in edit mode
                    shortcutElement.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    };
                    shortcutElement.style.cursor = 'default';
                }
                
                const faviconUrl = getFaviconUrl(shortcut.url);
                shortcutElement.innerHTML = `
                    ${isEditMode ? `<div class="shortcut-remove" onclick="event.stopPropagation(); event.preventDefault(); removeShortcut(${index}); return false;" title="Remove shortcut">√ó</div>` : ''}
                    <div class="shortcut-icon">
                        ${faviconUrl ? `<img src="${faviconUrl}" alt="" style="width: 100%; height: 100%; border-radius: 8px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">` : ''}
                        <span style="display: ${faviconUrl ? 'none' : 'block'};">${shortcut.title.charAt(0).toUpperCase()}</span>
                    </div>
                    <div class="shortcut-title">${shortcut.title}</div>
                `;
                
                grid.appendChild(shortcutElement);
            });
            
            // Add "Add New" button if less than 9 shortcuts
            if (shortcuts.length < 9) {                const addButton = document.createElement('div');
                addButton.className = 'shortcut-item add-new';
                addButton.onclick = addNewShortcut;
                addButton.innerHTML = `
                    <div class="shortcut-icon">
                        <span class="add-icon">+</span>
                    </div>
                    <div class="shortcut-title">${getLocalizedText('addSite')}</div>
                `;
                grid.appendChild(addButton);
            }
        }

        // Dialog functions
        function showPromptDialog(message, defaultValue, onResult) {
            if (window.DialogHandler && window.DialogHandler.postMessage) {
                const dialogId = Date.now().toString();
                window.pendingDialogs = window.pendingDialogs || {};
                window.pendingDialogs[dialogId] = { onResult };
                
                window.DialogHandler.postMessage(JSON.stringify({
                    type: 'prompt',
                    id: dialogId,
                    message: message,
                    defaultValue: defaultValue || ''
                }));            } else {
                const result = prompt(message, defaultValue);
                onResult && onResult(result);
            }
        }

        function showConfirmDialog(message, onConfirm, onCancel) {
            if (window.DialogHandler && window.DialogHandler.postMessage) {
                const dialogId = Date.now().toString();
                window.pendingDialogs = window.pendingDialogs || {};
                window.pendingDialogs[dialogId] = { onConfirm, onCancel };
                
                window.DialogHandler.postMessage(JSON.stringify({
                    type: 'confirm',
                    id: dialogId,
                    message: message
                }));
            } else {
                if (confirm(message)) {
                    onConfirm && onConfirm();
                } else {
                    onCancel && onCancel();
                }
            }
        }

        // Add new shortcut
        function addNewShortcut() {
            showPromptDialog(getLocalizedText('enterWebsiteUrl'), '', (url) => {
                if (url && url.trim()) {
                    const cleanUrl = url.trim();
                    const defaultTitle = cleanUrl.replace(/^https?:\/\//, '').replace(/^www\./, '');
                      showPromptDialog(getLocalizedText('enterShortcutTitle'), defaultTitle, (title) => {
                        if (title && title.trim()) {
                            const newShortcut = {
                                title: title.trim(),
                                url: cleanUrl
                            };
                            
                            shortcuts.push(newShortcut);
                            localStorage.setItem('solarShortcuts', JSON.stringify(shortcuts));
                            renderShortcuts();
                        }
                    });
                }
            });
        }        // Remove shortcut
        function removeShortcut(index) {
            const shortcut = shortcuts[index];
            
            if (isEditMode) {
                // In edit mode, remove immediately without confirmation
                shortcuts.splice(index, 1);
                localStorage.setItem('solarShortcuts', JSON.stringify(shortcuts));
                renderShortcuts();
            } else {
                // In normal mode, show confirmation
                const confirmMessage = getLocalizedText('removeShortcutConfirm').replace('{title}', shortcut.title);
                showConfirmDialog(confirmMessage, () => {
                    shortcuts.splice(index, 1);
                    localStorage.setItem('solarShortcuts', JSON.stringify(shortcuts));
                    renderShortcuts();
                });
            }
        }

        // Theme functions
        function applyTheme(themeData) {
            console.log('üé® Applying theme:', themeData);
            
            let theme = themeData;
            if (typeof themeData === 'string') {
                try {
                    theme = JSON.parse(themeData);
                } catch (e) {
                    console.error('Failed to parse theme data:', e);
                    return;
                }
            }
            
            // Update current theme
            if (theme.type === 'fullTheme') {
                currentTheme = theme;
            } else if (theme.type === 'theme') {
                currentTheme.isDark = theme.theme === 'dark';
                currentTheme.themeName = theme.theme;
            }
            
            // Apply theme classes
            const body = document.body;
            body.classList.remove('theme-light', 'theme-dark');
            body.classList.add(`theme-${currentTheme.isDark ? 'dark' : 'light'}`);
            
            // Remove existing dynamic theme style
            const existingStyle = document.getElementById('dynamic-theme');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            // Create new dynamic CSS
            const themeStyle = document.createElement('style');
            themeStyle.id = 'dynamic-theme';
            
            themeStyle.textContent = `
                :root {
                    --bg-primary: ${currentTheme.colors.backgroundColor} !important;
                    --bg-surface: ${currentTheme.colors.surfaceColor} !important;
                    --text-primary: ${currentTheme.colors.textColor} !important;
                    --text-secondary: ${currentTheme.colors.textSecondaryColor} !important;
                    --color-primary: ${currentTheme.colors.primaryColor} !important;
                    --color-accent: ${currentTheme.colors.accentColor} !important;
                    --color-error: ${currentTheme.colors.errorColor} !important;
                    --color-success: ${currentTheme.colors.successColor} !important;
                    --color-warning: ${currentTheme.colors.warningColor} !important;
                    --color-secondary: ${currentTheme.colors.secondaryColor} !important;
                }
                
                body {
                    background: ${currentTheme.colors.backgroundColor} !important;
                    color: ${currentTheme.colors.textColor} !important;
                }
            `;
            
            document.head.appendChild(themeStyle);
            console.log('‚úÖ Theme applied successfully');
        }

        // Request functions
        function requestTheme() {
            if (window.ThemeHandler && window.ThemeHandler.postMessage) {
                try {
                    window.ThemeHandler.postMessage('getTheme');
                    console.log('‚úÖ Theme request sent to Flutter');
                } catch (e) {
                    console.error('‚ùå Error requesting theme:', e);
                }
            } else {
                console.log('‚ö†Ô∏è ThemeHandler not available');
            }
        }

        function requestSearchEngine() {
            if (window.SearchEngineHandler && window.SearchEngineHandler.postMessage) {
                try {
                    window.SearchEngineHandler.postMessage('getSearchEngine');
                    console.log('‚úÖ Search engine request sent to Flutter');
                } catch (e) {
                    console.error('‚ùå Error requesting search engine:', e);
                }
            } else {
                console.log('‚ö†Ô∏è SearchEngineHandler not available');
            }
        }

        function detectLanguage() {
            if (window.LanguageHandler && window.LanguageHandler.postMessage) {
                try {
                    window.LanguageHandler.postMessage('getLanguage');
                    console.log('‚úÖ Language request sent to Flutter');
                } catch (e) {
                    console.error('‚ùå Error requesting language:', e);
                    currentLanguage = 'en';
                }
            } else {
                console.log('‚ö†Ô∏è LanguageHandler not available, defaulting to English');
                currentLanguage = 'en';
            }
        }

        function refreshForLanguageChange() {
            console.log('üåê Language changed, refreshing UI...');
            updateLocalizedUI();            // Clear cached news to force re-fetch with new language
            localStorage.removeItem('solarNews');
            localStorage.removeItem('solarNewsTime');
            requestNews();
        }

        // Listen for Flutter messages - SINGLE LISTENER ONLY!
        window.addEventListener('message', function(event) {
            console.log('üì® Message received from Flutter:', event.data);
            
            if (event.data && typeof event.data === 'object') {
                const data = event.data;
                const type = data.type;

                switch (type) {
                    case 'theme':
                    case 'fullTheme':
                        console.log('üé® Applying theme from message');
                        applyTheme(data);
                        break;

                    case 'searchEngine':
                        console.log('üîç Updating search engine:', data.engine);
                        currentSearchEngine = data.engine || 'Google';
                        updateSearchEngineLogo();
                        break;

                    case 'language':
                        console.log('üåê Updating language:', data.language);
                        const newLanguage = data.language || 'en';
                        if (newLanguage !== currentLanguage) {
                            currentLanguage = newLanguage;
                            refreshForLanguageChange();
                        }
                        break;

                    case 'dialogResponse':
                        console.log('üó£Ô∏è Dialog response received:', data);
                        const dialogId = data.id;
                        const pendingDialog = window.pendingDialogs && window.pendingDialogs[dialogId];

                        if (pendingDialog) {
                            if (data.result !== undefined && pendingDialog.onResult) {
                                // Handle prompt response
                                pendingDialog.onResult(data.result);
                            } else if (data.confirmed !== undefined) {
                                // Handle confirm response
                                if (data.confirmed && pendingDialog.onConfirm) {
                                    pendingDialog.onConfirm();
                                } else if (!data.confirmed && pendingDialog.onCancel) {
                                    pendingDialog.onCancel();
                                }
                            }
                            // Clean up
                            delete window.pendingDialogs[dialogId];
                        }
                        break;

                    case 'newsUpdate':
                        console.log('üì∞ News update received from message');
                        renderNews(data.articles);
                        isNewsFetching = false;
                        break;

                    default:
                        console.log('‚ö†Ô∏è Unknown message type:', type);
                        break;
                }
            }        });

        // Initialize the homepage properly - NO MORE FAKE NEWS!
        setTimeout(() => {
            console.log('üöÄ Initializing Solar Browser homepage - REAL NEWS ONLY!');
            
            // FORCE CLEAR ALL CACHED NEWS - NO MORE OLD FAKE NEWS!
            localStorage.removeItem('solarNews');
            localStorage.removeItem('solarNewsTime');
            console.log('üóëÔ∏è CLEARED ALL CACHED NEWS - FORCING FRESH FETCH');
            
            detectLanguage();
            requestTheme();
            requestSearchEngine();
            updateLocalizedUI();
            
            // Use Flutter NewsHandler to fetch news if available
            if (window.NewsHandler && window.NewsHandler.postMessage) {
                console.log('üì∞ Using Flutter NewsHandler to fetch news...');
                window.NewsHandler.postMessage('fetchNews');
            } else {
                console.log('üì∞ NewsHandler not available, requesting news...');
                requestNews(); // Request news from Flutter
            }
            
            console.log('‚úÖ Homepage initialized with REAL news from Firebase API');
        }, 100);
          console.log('‚úÖ Solar Browser main.html fully loaded - NO MORE FAKE NEWS!');
        console.log('üöÄ SCRIPT END - JavaScript completed successfully');
    </script>
</body>
</html>
